{% load static %}


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>BILLZIFY</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"> 



    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'undercss/assets/vendor/fonts/boxicons.css'%}" />

    <!-- Libraries Stylesheet -->
    <link href="{% static 'vendorwebcss/lib/animate/animate.min.css'%}" rel="stylesheet">
    <link href="{% static 'vendorwebcss/lib/lightbox/css/lightbox.min.css'%}" rel="stylesheet">
    <link href="{% static 'vendorwebcss/lib/owlcarousel/assets/owl.carousel.min.css'%}" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="{% static 'vendorwebcss/css/bootstrap.min.css'%}" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="{% static 'vendorwebcss/css/style.css'%}" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">

    <!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap 5 JS (optional, for interactive components like modals, tooltips, etc.) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<style>
    /* Add Google Fonts */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

    body {
        font-family: 'Roboto', sans-serif;
    }
    /* Carousel Container */
    .carousel {
        position: relative;
        width: 92%;
        max-width: 600px;
        margin: auto;
        overflow: hidden;
        
        border-radius: 10px;
    }

    /* Carousel Images */
    .carousel-images {
        display: flex;
        transition: transform 0.5s ease-in-out;
    }

    .carousel-images img {
        width: 100%;
        border-right: 2px solid #ddd;
    }

    /* Navigation Buttons */
    .carousel-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background-color: rgba(0, 0, 0, 0);
        color: #fff;
        border: none;
        padding: 10px;
        cursor: pointer;
        font-size: 18px;
        border-radius: 50%;
    }

    .carousel-btn.left {
        left: 10px;
    }

    .carousel-btn.right {
        right: 10px;
    }
    
    
    /* For limiting paragraph to 2 lines */
.expandable-text {
    display: -webkit-box;
    -webkit-line-clamp: 2; /* Limit to 2 lines */
    -webkit-box-orient: vertical;
    overflow: hidden;
    max-height: 3.6em; /* Adjust based on line height */
    position: relative;
}

.expandable-text .more-link {
    display: inline-block;
    color: #007bff;
    text-decoration: none;
    margin-left: 10px; /* Add spacing between the content and the 'More' link */
}

.expandable-text.expanded {
    -webkit-line-clamp: unset; /* Remove the line clamp */
    max-height: none; /* Allow content to expand */
}

/* For limiting list items to 3 initially */
.responsive-dotted-list {
    list-style-type: none;
    padding: 0;
    margin: 0;
}

.responsive-dotted-list li {
    display: inline-block;
    padding-left: 20px; /* Space for the dot */
    position: relative;
    white-space: nowrap;
}

.responsive-dotted-list li::before {
    content: '•';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    font-size: 20px;
    color: #6244C5;
}

/* Show only 3 list items by default */
.responsive-dotted-list .expandable-item:nth-child(n+4) {
    display: none; /* Hide items after the 3rd */
}

/* Expand list items when 'expanded' class is added */
.responsive-dotted-list.expanded .expandable-item {
    display: inline-block; /* Show all items */
}

/* Adjust 'More' link in UL to align with the list items */
.responsive-dotted-list .more-link {
    display: inline-block;
    margin-right: 5px;
    color: #6244C5;
    text-decoration: none;
    margin-top: 10px; /* Space it a bit down for visual balance */
}

html, body {
    touch-action: manipulation;
}
    

/* Heart Style */
.heart {
    width: 12px;
    height: 12px;
    background-color: red;
    clip-path: polygon(50% 0%, 100% 37%, 82% 100%, 50% 80%, 18% 100%, 0% 37%);
    opacity: 0; /* Start invisible */
    animation: floatUp 1.3s ease-in-out forwards;
    z-index: 1000; /* Ensure it stays above all elements */
}

/* Heart Float Animation */
@keyframes floatUp {
    0% {
        transform: translate(0, -50%) scale(1);
        opacity: 1;
    }
    100% {
        transform: translate(-50%, -50px) scale(1.5); /* Float upwards */
        opacity: 0;
    }
}



</style>

</head>


{%if emptydata%}

<h6 class="text text-danger p-3" style="margin-top:305px">{{emptydata}}</h6>

{%else%}


<body data-bs-spy="scroll" data-bs-target=".navbar" data-bs-offset="51">
    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <!-- Spinner End -->


    <div style="height:60px;width:100%;box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px; position: fixed;
    top: 0;
    left: 0;z-index: 1000;background-color: white;
    color: #fff;"  >
            <img src="{{profile.profile_image.url}}" class="mt-1 ms-3" height="50px">
    </div>
    
   

    <!-- Header Start -->
    <div class=" w-100 py-5 my-6 mt-5" id="navbarCollapse">
        <div class="container">
            <div class="row g-1 align-items-center ">
                {% comment %} hotel profile data  {% endcomment %}
                {% for room in profiledata %}
                
                <div class="col-lg-12 mb-4  ">
                    <div class="portfolio-img rounded overflow-hidden shadow">
                        <div class="carousel mt-4">
                            <!-- Carousel Images -->
                            <div class="carousel-images" id="first-carousel-images-{{ forloop.counter }}">
                                {% for image in imagedata %}
                                    <img src="{{ image.image.url }}" alt="Image for {{ room.category_name }}">
                                {% endfor %}
                            </div>
                        
                            <!-- Navigation Buttons -->
                            <button class="carousel-btn left" onclick="prevFirstImage({{ forloop.counter }})">&#10094;</button>
                            <button class="carousel-btn right" onclick="nextFirstImage({{ forloop.counter }})">&#10095;</button>
                        </div>
                        {%for csll in prfmcdata%}
                        <h5 class="text-gray  m-3" >{{room.name}}</h5>
                        <p class="expandable-text ps-3" id="room-{{ forloop.counter }}">
                            {{ room.address }}  </p>
                            <p class="ms-3">{{csll.guestemail}}
                        </p>
                    
                       
    
                        <div class="m-3  " >
                            <hr>
                            <div class="row">
                                
                                <div class="col-3 "><a href="#target-div" style="text-decoration:none">₹ Price</a></div>|
                                <div class="col-5">
                                    <a  href="{{csll.linkmap}}">
                                        <i class="bi bi-compass"></i> &nbsp;&nbsp;&nbsp;Direction
                                    </a>
                                    </div>|
                                <div class="col-3">
                                  <a  href="tel:+91{{csll.phome}}"><i class="bi bi-telephone-fill"></i>  Call</a>
                                </div>
                                {%endfor%}
                            </div>
                            
                        </div>
    
                       
                        
                    </div>
                </div>
                </div>{%endfor%}
                <div class="col-lg-12 mb-5 mt-4">
              
                    <div class="portfolio-img rounded overflow-hidden shadow">
                        <form action="{% url 'searchwebsitedata' %}" method="post">
                            {% csrf_token %}
                            <div class="row p-2">
                            <div class=" col-5  w-50 ">
                                <label for="zipCode" class="form-label">CheckIn Date </label>
                                <input
                                  type="date"
                                  class="form-control"
                                  value="{{today|date:'Y-m-d'}}"
                                  id="zipcode"
                                  name="checkin_date" required
                                  placeholder="Like: 11:00am"
                                  maxlength="8"
                                />
                              </div> 

                              <input type="hidden"  name="userid" value="{{user}}" />
                              
                              <input type="hidden" id="check-in" value="{{today}}" />
                              <input type="hidden" id="check-out" value="{{tomorrow}}" />
                              <div class="col-5 w-50 ">
                                <label for="zipCode" class="form-label">CheckOut Date </label>
                                <input
                                  type="date"
                                  class="form-control"
                                  value="{{tomorrow|date:'Y-m-d'}}"
                                  id="xxx"
                                  name="checkout_date" required
                                  placeholder="Like: 11:00am"
                                  maxlength="8"
                                />
                              </div> 
                            </div>

                          
                            
                                <div class="col-12 w-100 p-2 mb-2 mt-2">
                                <button href="#target-div" type="submit" class="btn btn-primary w-100 ">Change Dates</button>
                                </div>

                        </form>
                     </div>
                </div>
             
            <h5 class="text-gray  m-1  py-4"style="color:gray"   id="target-div">Choose your rooms</h5>
          


    {% for room in rooms %}
    <div class="col-lg-12 mb-5">
        <div class="portfolio-img rounded overflow-hidden shadow">
            <div class="carousel mt-4">
                <div class="carousel-images" id="second-carousel-images-{{ forloop.counter }}">
                    {% for image in room.images.all %}
                    <img src="{{ image.image.url }}" alt="Image for {{ room.category_name }}">
                    {% endfor %}
                </div>
                <button class="carousel-btn left" onclick="prevSecondImage({{ forloop.counter }})">&#10094;</button>
                <button class="carousel-btn right" onclick="nextSecondImage({{ forloop.counter }})">&#10095;</button>
            </div>
            
            <h5 class="text-gray m-3">{{ room.category_name }}</h5>
            {%if forloop.counter == 1 %}
            
            <ul class="responsive-dotted-list ps-3 pt-0">
                {%for ame in aminities%}
                <li class="expandable-item">{{ame.description}}</li>
                {%endfor%}
                <a href="#" class="more-link text-primary">More</a>
            </ul>
            {%endif%}
            
            <p class="text ms-3 m-1"><span class="text-danger">*</span>Hurry, Only {{ room.available_rooms }} Rooms Left!</p>
    
            {% if room.available_rooms > 0 %}
            {% for plan in rateplanmaxuser %}
            {% if plan.room_category.category_name == room.category_name %}
            <div class="m-3 p-3 border rounded-1">
                <div class="row">
                    <div class="col-12 pt-1">
                        <b>{{ plan.rate_plan_name }}</b> 
                            
                        <button class="btn btn-light float-end" data-bs-toggle="modal" data-bs-target="#planModal{{ forloop.counter }}">
                            <i class="bi bi-info-circle"></i> 
                        </button>

                        <p>For {{ plan.max_persons }} Adults & {{ plan.childmaxallowed }} Child <i class='bx bx-child'></i></p>
                        
                                <!-- Info Button for each plan -->
           

            <!-- Modal for each plan -->
            <div class="modal fade" id="planModal{{ forloop.counter }}" tabindex="-1" aria-labelledby="planModalLabel{{ forloop.counter }}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="planModalLabel{{ forloop.counter }}">Plan: {{ plan.rate_plan_name }} </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p>In This Plan: {{ plan.rate_plan_description }}</p>
                            <hr>
                            <p>cancellation policy:</p>
                            
                             <p>{{cpolicy.cancellention_policy}}</p><hr>

                                <label for="full-name"><b>Terms & Conditions</b><br><br>
                                {% for line in terms_lines %}
                                    <p>{{ line }}</p>
                                {% endfor %}
                        
                           
                            <!-- You can add more information as needed -->
                        </div>
                    </div>
                </div>
            </div>


                    </div>
                    <div class="col-7">
                        <span><del>₹ {{ plan.base_price|add:room.delprice }}</del></span><br>
                        <span><b>₹ {{ room.uprice|add:plan.base_price }}</b></span><br>
                        <span class="text-success"><b>GET ₹ {{room.offeramount}}</b> Off</span><br>
                         
                    </div>
                    <div class="col-5">
                        <center>
                            {% comment %} <button class="btn btn-dark w-100 mt-2"
                                onclick="addToCart('{{ forloop.counter }}', '{{ room.category_name }}', '{{ plan.rate_plan_name }}', {{ plan.max_persons }}, {{ plan.childmaxallowed }}, {{ room.uprice|add:plan.base_price }}, {{ room.tax }}, {{ room.available_rooms }})">
                                Add
                            </button> {% endcomment %}
                            {% comment %} <button class="btn btn-dark w-100 mt-2" id="add-to-cart-{{ forloop.counter }}"
                            onclick="addToCart('{{ forloop.counter }}', '{{ room.category_name }}', '{{ plan.rate_plan_name }}', {{ plan.max_persons }}, {{ plan.childmaxallowed }}, {{ room.uprice|add:plan.base_price }}, {{ room.tax }}, {{ room.available_rooms }}, {{ room.offeramount }})">
                            Add to Cart
                          </button> {% endcomment %}

                          {% comment %} <button class="btn btn-dark w-100 mt-2" 
        id="add-to-cart-{{ forloop.counter }}" 
        onclick="addToCart('{{ forloop.counter }}', 
                          '{{ room.category_name }}', 
                          '{{ plan.rate_plan_name }}', 
                          {{ plan.max_persons }}, 
                          {{ plan.childmaxallowed }}, 
                          {{ room.uprice|add:plan.base_price }}, 
                          {{ room.tax }}, 
                          {{ room.available_rooms }}, 
                          {{ room.offeramount }})">
    Add to Cart
</button> {% endcomment %}

<button class="btn btn-dark w-100 mt-2 position-relative overflow-hidden" 
        id="add-to-cart-{{ forloop.counter }}" 
        onclick="handleAddToCartAnimation(this, '{{ forloop.counter }}', 
                          '{{ room.category_name }}', 
                          '{{ plan.rate_plan_name }}', 
                          '{{plan.rate_plan_code}}',
                          {{ plan.max_persons }}, 
                          {{ plan.childmaxallowed }}, 
                          {{ room.uprice|add:plan.base_price }}, 
                          {{ room.tax }}, 
                          {{ room.available_rooms }}, 
                          {{ room.offeramount }})">
    Add to Cart
</button>



                          
                        </center>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
            {% else %}
            <button class="btn btn-danger m-2 float-end">All Rooms Sold</button>
            {% endif %}
        </div>
    </div>
    {% endfor %}
    

        
    <!-- Header End -->

    <script>
        function handleAddToCartAnimation(button, roomId, categoryName, ratePlanName, ratePlanCode, adults, children, roomPrice, taxRate, availableRooms, offerAmount) {
            // Trigger the cart functionality
            addToCart(roomId, categoryName, ratePlanName, ratePlanCode, adults, children, roomPrice, taxRate, availableRooms, offerAmount);
    
            // Create hearts and add animation above the button
            const buttonRect = button.getBoundingClientRect(); // Get button position
            for (let i = 0; i < 3; i++) {
                const heart = document.createElement("div");
                heart.className = "heart";
                heart.style.left = `${Math.random() * 80 + 10}%`; // Random horizontal position within button
                heart.style.top = `-${Math.random() * 20}px`; // Slight random vertical offset
                heart.style.animationDelay = `${i * 0.3}s`; // Slight delay for each heart
                document.body.appendChild(heart);
    
                // Position the heart above the button
                const topPosition = buttonRect.top + window.scrollY - 20; // Adjust for scroll position
                heart.style.position = "absolute";
                heart.style.left = `${buttonRect.left + button.offsetWidth / 2}px`;
                heart.style.top = `${topPosition}px`;
    
                // Remove the heart after the animation
                setTimeout(() => {
                    heart.remove();
                }, 2000); // Match animation duration
            }
        }
    </script>
    
    

    <div class="container" style="display:none">
        {% if cheapest_room and cheapest_rate_plan %}
            <div class="card">
                <h5 class="card-header">Cheapest Room Available</h5>
                <div class="card-body">
                    <h6 class="card-title">{{ cheapest_room.category_name }}</h6>
                    <p class="card-text">
                        Rate Plan: <strong>{{ cheapest_rate_plan.rate_plan_name }}</strong><br>
                        Total Price: ₹{{ lowest_price }}<br>
                        Adults Allowed: {{ cheapest_rate_plan.max_persons }}<br>
                        Children Allowed: {{ cheapest_rate_plan.childmaxallowed }}<br>
                        Tax Rate: {{ cheapest_room.tax }}%<br>
                        Offer: ₹{{ cheapest_room.offeramount }} off<br>
                        Available Rooms: {{ cheapest_room.available_rooms }}
                    </p>
                    <button class="btn btn-dark">Book Now</button>
                </div>
            </div>
        {% else %}
            <p class="text-danger">No rooms are available at the moment.</p>
        {% endif %}
    </div>
    
    <div class="col-lg-12 mb-5 card p-3">
    <div class="form-group mb-5  ">
        <label for="full-name"><b>Terms & Conditions</b><br><br>
        {% for line in terms_lines %}
            <p>{{ line }}</p>
        {% endfor %}

        <div>
    </div>

</div>
</div>
</div>


<!-- Cart Popup Modal -->
<div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cartModalLabel">Cart Summary</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body">
                <!-- Cart Items -->
                
                <div id="cart-items" class="mb-3"></div>
                <div class="card p-2 border-top mb-1">
                    <p class="text-success"><b>BOOK NOW & PAY LATER</b> (Pay At Hotel)</p>
                    <p>CheckIn Date: {{today}} ,Check-In Time: {{profile.checkintimes}}</p>
                    <p>CheckOut Date: {{tomorrow}} ,Check-Out Time: {{profile.checkouttimes}}</p>
                    <p>Total Days: <span id="days-diff">{{daysdiff}}</span></p> <!-- This will show the number of days -->
                   
                </div>
                
                <!-- Cart Summary Section -->
                <div class="card p-2 border-top pt-3 mb-5">
                    <h6>Cart Summary (for <b>{{daysdiff}}</b> days)</h6>
                    
                    <!-- Success message container (hidden by default) -->
                    <div id="success-message" style="display: none; padding: 10px; background-color: #d4edda; color: #155724; border-radius: 5px;">
                        <!-- Success message will be inserted here -->
                    </div>

                    <div class="d-flex justify-content-between">
                        <p>Total Amount</p>
                        <p>₹<span id="total-price">0</span></p>
                    </div>
                    <div class="d-flex justify-content-between text-success">
                        <p>Discount</p>
                        <p><i class="bi bi-gift"></i> ₹<span id="discount-amount">0</span></p>
                    </div>
                    <div class="d-flex justify-content-between">
                        <p>Subtotal</p>
                        <p>₹<span id="subtotal-amount">0</span></p>
                    </div>
                    <div class="d-flex justify-content-between">
                        <p>Total Tax</p>
                        <p>₹<span id="total-tax">0</span></p>
                    </div>
                    
                    <hr>
                    <div class="d-flex justify-content-between">
                        <p><b>Grand Total</b></p>
                        <p><b>₹<span id="grand-total">0</span></b></p>
                    </div>
                    <hr>

                   

                <div class="mt-3" id="toggle-card" style="display: none; ">
                    <!-- Hidden form initially -->
                     
                <h4 class="ms2 text-center" id="scrollmain">Guest Details</h4><hr>
                    <form id="cart-form" method="post" >
                    {% csrf_token %}

                        <div class=" col-12  p-1 ">
                            <label for="zipCode" class="form-label"><i class="bi bi-person-fill"></i> YOUR NAME </label>
                            <input
                              type="text"
                              class="form-control"
                              
                              name="guestname"
                              placeholder="EX: VAIDIK JAIN"
                              maxlength=""
                              required
                            />
                          </div> 

                          <div class=" col-12  p-1 ">
                            <label for="zipCode" class="form-label"><i class="bi bi-telephone-fill"></i> YOUR PHONE </label>
                            <input
                                type="tel"
                                pattern="[6-9][0-9]{9}"
                              class="form-control"
                              
                              name="guestphone"
                              placeholder="EX: 9179223301"
                              maxlength="10"
                              required
                            />
                          </div> 

                          

                          <div class=" col-12  p-1 ">
                            <label for="zipCode" class="form-label"><i class="bi bi-globe"></i> Country</label>
                            <input
                              type="text"
                              class="form-control"
                              value="INDIA"
                              name="Country"
                              placeholder="INDIA"
                              maxlength="30"
                              required
                            />
                          </div> 

                          <div class=" col-12  p-1 ">
                            <label for="zipCode" class="form-label"><i class="bi bi-geo-alt"></i> Address</label>
                            <input
                              type="text"
                              class="form-control"
                             
                              name="adress"
                              placeholder="EX: Mumbai 101223"
                              maxlength="50"
                            />
                          </div> 

                          <div class=" col-12  p-1 mb-2">
                            <label for="zipCode" class="form-label"><i class="bi bi-vector-pen"></i> Speacial Request ! </label>
                            <input
                              type="text"
                              class="form-control"
                              
                              name="Speacialrequest"
                              placeholder="Request Here!"
                              maxlength="50"
                            />
                          </div> 

                          <input type="hidden" id="userid" value="{{user}}" />
                   
                    <p class="ps-2">By proceeding, I agree to hotel terms and conditions and cancellation policies</p>

                    <button type="submit" class="btn btn-success w-100 mb-3">BOOKING DONE</button>
                </form>
            </div>

             <!-- Toggle Button -->
             <button type="button" id="toggleButton" herf="#scrollmain" class="btn btn-dark">Continue</button>
                   
            </div>
            </div>
        </div>
    </div>
</div>


<script>
    // JavaScript to handle the toggling of the form visibility with scrollable div
    document.getElementById('toggleButton').addEventListener('click', function() {
        const form = document.getElementById('toggle-card');
        if (form.style.display === 'none' || form.style.display === '') {
            form.style.display = 'block';  // Show the form
            
            document.getElementById('toggleButton').style.display = "none";
        } else {
            form.style.display = 'none';  // Hide the form
        }
    });
</script>


<!-- Bottom Cart View -->
<div id="bottom-cart-view" class="fixed-bottom d-none px-3 py-2" style="height: auto; background: white; border-radius: 12px 12px 0 0; color: white; box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.2);">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h6>Total: ₹<span id="fixed-total-price">0</span></h6>
            <h6>Add-Rooms: <span id="total-rooms">0</span></h6> <!-- Show total rooms -->
        </div>
        <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#cartModal" style="font-size: 16px;">View Cart</button>
    </div>
</div>


<script>
    const cart = {}; // Holds the cart items
    let totalPrice = 0; // Total price for the cart
    let totalTax = 0; // Total tax for the cart
    let totalRooms = 0; // Total rooms booked
    let totalDiscount = 0; // Total discount applied

    // Automatically add the cheapest room to the cart
    document.addEventListener("DOMContentLoaded", () => {
        const cheapestRoomId = "{{ cheapest_room.id|default:'' }}";
        const cheapestRoomCategory = "{{ cheapest_room.category_name|escapejs }}";
        const cheapestRatePlanName = "{{ cheapest_rate_plan.rate_plan_name|escapejs }}";
        const cheapestRatePlanCode = "{{cheapest_rate_plan.rate_plan_code|escapejs}}";
        const cheapestRoomAdults = parseInt("{{ cheapest_rate_plan.max_persons|default:0 }}");
        const cheapestRoomChildren = parseInt("{{ cheapest_rate_plan.childmaxallowed|default:0 }}");
        const cheapestRoomPrice = parseFloat("{{ lowest_price|default:0 }}");
        const cheapestRoomTaxRate = parseFloat("{{ cheapest_room.tax|default:0 }}");
        const cheapestRoomAvailable = parseInt("{{ cheapest_room.available_rooms|default:0 }}", 10);
        const cheapestRoomOffer = parseFloat("{{ cheapest_room.offeramount|default:0 }}");

        if (cheapestRoomId && cheapestRoomAvailable > 0) {
            addToCart(
                cheapestRoomId,
                cheapestRoomCategory,
                cheapestRatePlanName,
                cheapestRatePlanCode,
                cheapestRoomAdults,
                cheapestRoomChildren,
                cheapestRoomPrice,
                cheapestRoomTaxRate,
                cheapestRoomAvailable,
                cheapestRoomOffer
            );
        }
    });

    // Toggle the visibility of the cart section
    function toggleCartVisibility() {
        const bottomCartView = document.getElementById("bottom-cart-view");
        const cartItemsDiv = document.getElementById("cart-items");
        const isVisible = Object.keys(cart).some((roomId) => cart[roomId]?.count > 0);

        bottomCartView.classList.toggle("d-none", !isVisible);
        if (!isVisible) {
            cartItemsDiv.innerHTML = ""; // Clear cart display if cart is empty
        }
    }

    // Add room to the cart
    function addToCart(roomId, categoryName, ratePlanName,ratePlanCode ,adults, children, roomPrice, taxRate, availableRooms, offerAmount) {
        if (!cart[roomId]) {
            cart[roomId] = {
                count: 0,
                category: categoryName,
                ratePlan: ratePlanName,
                ratePlancode:ratePlanCode,
                adultsPerRoom: adults,
                childrenPerRoom: children,
                price: roomPrice,
                taxRate: taxRate,
                max: availableRooms,
                adults: 0,
                children: 0,
                offerAmount: offerAmount
            };
        }

        let totalBookedInCategory = 0;
        for (const roomKey in cart) {
            if (cart[roomKey].category === categoryName) {
                totalBookedInCategory += cart[roomKey].count;
            }
        }

        if (totalBookedInCategory < availableRooms) {
            cart[roomId].count += 1;
            cart[roomId].adults += adults;
            cart[roomId].children += children;
            totalPrice += roomPrice;
            totalTax += (roomPrice * taxRate) / 100;
            totalRooms += 1;
            totalDiscount += offerAmount;

            updateCart();
            toggleCartVisibility();
        } else {
            alert("All rooms in this category are booked!");
        }
    }

    // Remove room from the cart
    function removeFromCart(roomId) {
        if (cart[roomId] && cart[roomId].count > 0) {
            totalPrice -= cart[roomId].price;
            totalTax -= (cart[roomId].price * cart[roomId].taxRate) / 100;
            totalRooms -= 1;
            totalDiscount -= cart[roomId].offerAmount;

            cart[roomId].adults -= cart[roomId].adultsPerRoom;
            cart[roomId].children -= cart[roomId].childrenPerRoom;
            cart[roomId].count -= 1;

            if (cart[roomId].count === 0) {
                delete cart[roomId];
            }

            updateCart();
            toggleCartVisibility();
        }
    }

    // Update the cart display and totals
    function updateCart() {
        const cartItemsDiv = document.getElementById("cart-items");
        cartItemsDiv.innerHTML = ""; // Clear the cart display
        const daysDiff = getDays(); // Get the number of days for the stay

        let totalPriceAdjusted = 0;
        let totalTaxAdjusted = 0;
        let totalDiscountAdjusted = 0;

        for (const roomId in cart) {
            if (cart[roomId].count > 0) {
                const room = cart[roomId];
                const roomDiv = document.createElement("div");
                roomDiv.classList.add("cart-item", "border", "rounded", "p-2", "mb-2", "d-flex", "shadow", "justify-content-between");
                roomDiv.style.background = "#FFF";
                roomDiv.style.fontSize = "14px";

                roomDiv.innerHTML = `
                    <div>
                        <h6>${room.category} - ${room.ratePlan}</h6>
                        <p>Adults: ${room.adults} | Children: ${room.children}</p>
                        <p>Price: ₹${room.price} | Tax Rate: ${room.taxRate}%</p>
                    </div>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-success me-2" onclick="addToCart('${roomId}', '${room.category}', '${room.ratePlan}', ${room.ratePlancode},${room.adultsPerRoom}, ${room.childrenPerRoom}, ${room.price}, ${room.taxRate}, ${room.max}, ${room.offerAmount})" ${
                            cart[roomId].count >= room.max ? "disabled" : ""
                        }>+</button>
                        <span>${room.count}</span>
                        <button class="btn btn-danger ms-2" onclick="removeFromCart('${roomId}')">-</button>
                    </div>
                `;
                cartItemsDiv.appendChild(roomDiv);

                totalPriceAdjusted += room.price * room.count * daysDiff;
                totalTaxAdjusted += (room.price * room.count * room.taxRate) / 100 * daysDiff;
                totalDiscountAdjusted += room.offerAmount * room.count * daysDiff;
            }
        }

        const discountAmount = totalDiscountAdjusted;
        const subtotalAmount = totalPriceAdjusted + totalTaxAdjusted - discountAmount;
        const grandTotal = totalPriceAdjusted + totalTaxAdjusted;

        // Update the totals display
        document.getElementById("fixed-total-price").innerText = totalPriceAdjusted.toFixed(2);
        document.getElementById("total-price").innerText = (totalPriceAdjusted + discountAmount).toFixed(2);
        document.getElementById("total-tax").innerText = totalTaxAdjusted.toFixed(2);
        document.getElementById("grand-total").innerText = grandTotal.toFixed(2);
        document.getElementById("total-rooms").innerText = totalRooms;
        document.getElementById("discount-amount").innerText = discountAmount.toFixed(2);
        document.getElementById("subtotal-amount").innerText = totalPriceAdjusted.toFixed(2);
    }

    // Get the number of days from the stay duration
    function getDays() {
        const days = parseInt(document.getElementById("days-diff").innerText, 10);
        return isNaN(days) || days <= 0 ? 1 : days;
    }

    // Handle form submission via JavaScript
   
    document.addEventListener("DOMContentLoaded", function () {
        const csrfTokenElement = document.querySelector('[name=csrfmiddlewaretoken]');
        
        if (csrfTokenElement) {
            const csrfToken = csrfTokenElement.value;
            console.log("CSRF Token:", csrfToken);
        
            document.getElementById("cart-form").addEventListener("submit", function (event) {
                event.preventDefault();  // Prevent the default form submission
        
                // Ensure the cart object and other variables exist
                console.log("Cart object:", cart);
        
                const checkInDate = document.getElementById("check-in") ? document.getElementById("check-in").value : '';
                const checkOutDate = document.getElementById("check-out") ? document.getElementById("check-out").value : '';
                console.log("Check-in Date:", checkInDate);
                console.log("Check-out Date:", checkOutDate);
        
                console.log("Total Price:", totalPrice);
                console.log("Total Tax:", totalTax);
                console.log("Total Discount:", totalDiscount);
                console.log("Total Rooms:", totalRooms);
        
                // Collect form data with null checks for optional fields
            const guestName = document.querySelector('[name="guestname"]').value || '';  // Default to empty string if undefined
            const guestPhone = document.querySelector('[name="guestphone"]').value || '';  // Default to empty string if undefined
            const guestCountry = document.querySelector('[name="Country"]').value || '';  // Default to empty string if undefined
            const guestAddress = document.querySelector('[name="adress"]').value || null;  // Null if no value provided
            const specialRequest = document.querySelector('[name="Speacialrequest"]').value || null;  // Null if no value provided
            const userids = document.getElementById("userid").value;
            
                // Prepare the full cart and form data
                const cartData = {
                    items: Object.keys(cart).map(roomId => ({
                        id: roomId,
                        count: cart[roomId].count,
                        category: cart[roomId].category,
                        ratePlan: cart[roomId].ratePlan,
                        ratePlancode:cart[roomId].ratePlancode,
                        price: cart[roomId].price,
                        taxRate: cart[roomId].taxRate,
                        offerAmount: cart[roomId].offerAmount,
                        adults:cart[roomId].adults,
                        children:cart[roomId].children,

                    })),
                    totalPrice: totalPrice,
                    totalTax: totalTax,
                    totalDiscount: totalDiscount,
                    totalRooms: totalRooms,
                    checkIn: checkInDate,
                    checkOut: checkOutDate,
                    days: getDays(),
                    guestName: guestName,
                    guestPhone: guestPhone,
                    guestCountry: guestCountry,
                    guestAddress: guestAddress,
                    specialRequest: specialRequest,
                    userid:userids,
                };
        
                console.log("Full Data Sent:", cartData);
        
                // Send data via fetch API
                fetch("{% url 'your_cart_processing_view' %}", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": csrfToken,
                    },
                    body: JSON.stringify(cartData)
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log("Response from server:", data);
                        if (data.success) {
                            //alert("Booking successfully done!");
                            const bookingId = data.id; // Assuming the server sends the booking ID
                            window.location.href = `/receipt/${bookingId}/`;
                        } else {
                            alert(data.message);
                            window.location.reload();
                           
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        alert("There was an error processing the cart.");
                        window.location.reload();
                    });
            });
        } else {
            console.error("CSRF Token element not found.");
            alert("There was an error processing the cart.");
            window.location.reload();
        }
    });
    

    
    
    
    
    
</script>



    <script>
       
        
        // Objects to store the current index of each carousel
const firstCarouselIndex = {};
const secondCarouselIndex = {};

// Initialize indices for both carousels
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll('[id^="first-carousel-images"]').forEach((carousel, index) => {
        const id = `first-carousel-images-${index + 1}`;
        firstCarouselIndex[id] = 0;
        updateFirstCarousel(id);
    });

    document.querySelectorAll('[id^="second-carousel-images"]').forEach((carousel, index) => {
        const id = `second-carousel-images-${index + 1}`;
        secondCarouselIndex[id] = 0;
        updateSecondCarousel(id);
    });
});

// First Carousel Functions
function prevFirstImage(counter) {
    const id = `first-carousel-images-${counter}`;
    const images = document.querySelectorAll(`#${id} img`);
    if (firstCarouselIndex[id] > 0) {
        firstCarouselIndex[id]--;
    } else {
        firstCarouselIndex[id] = images.length - 1;
    }
    updateFirstCarousel(id);
}

function nextFirstImage(counter) {
    const id = `first-carousel-images-${counter}`;
    const images = document.querySelectorAll(`#${id} img`);
    if (firstCarouselIndex[id] < images.length - 1) {
        firstCarouselIndex[id]++;
    } else {
        firstCarouselIndex[id] = 0;
    }
    updateFirstCarousel(id);
}

function updateFirstCarousel(id) {
    const images = document.querySelectorAll(`#${id} img`);
    images.forEach((img, index) => {
        img.style.display = index === firstCarouselIndex[id] ? 'block' : 'none';
    });
}

// Second Carousel Functions
function prevSecondImage(counter) {
    const id = `second-carousel-images-${counter}`;
    const images = document.querySelectorAll(`#${id} img`);
    if (secondCarouselIndex[id] > 0) {
        secondCarouselIndex[id]--;
    } else {
        secondCarouselIndex[id] = images.length - 1;
    }
    updateSecondCarousel(id);
}

function nextSecondImage(counter) {
    const id = `second-carousel-images-${counter}`;
    const images = document.querySelectorAll(`#${id} img`);
    if (secondCarouselIndex[id] < images.length - 1) {
        secondCarouselIndex[id]++;
    } else {
        secondCarouselIndex[id] = 0;
    }
    updateSecondCarousel(id);
}

function updateSecondCarousel(id) {
    const images = document.querySelectorAll(`#${id} img`);
    images.forEach((img, index) => {
        img.style.display = index === secondCarouselIndex[id] ? 'block' : 'none';
    });
}


        document.querySelectorAll('.more-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const pTag = this.closest('.expandable-text');
                const ulTag = this.closest('.responsive-dotted-list');
        
                // Toggle paragraph expansion
                if (pTag) {
                    pTag.classList.toggle('expanded');
                    this.textContent = pTag.classList.contains('expanded') ? 'Less' : 'More'; // Toggle text
                }
        
                // Toggle list expansion
                if (ulTag) {
                    ulTag.classList.toggle('expanded');
                    this.textContent = ulTag.classList.contains('expanded') ? 'Less' : 'More'; // Toggle text
                }
            });
        });
        
        
    </script>



    
</body>

</html>



             <!DOCTYPE html>
             <html lang="en">
             
             <head>
                 <meta charset="utf-8">
                 <title>profile</title>
                 <meta content="width=device-width, initial-scale=1.0" name="viewport">
                 <meta content="" name="keywords">
                 <meta content="" name="description">
             
                 <!-- Favicon -->
                 <link href="img/favicon.ico" rel="icon">
             
                 <!-- Google Web Fonts -->
                 <link rel="preconnect" href="https://fonts.googleapis.com">
                 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
                 <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"> 
             
                 <!-- Icon Font Stylesheet -->
                 <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
                 <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
             
                 <!-- Libraries Stylesheet -->
                 <link href="{% static 'vendorwebcss/lib/animate/animate.min.css'%}" rel="stylesheet">
                 <link href="{% static 'vendorwebcss/lib/lightbox/css/lightbox.min.css'%}" rel="stylesheet">
                 <link href="{% static 'vendorwebcss/lib/owlcarousel/assets/owl.carousel.min.css'%}" rel="stylesheet">
             
                 <!-- Customized Bootstrap Stylesheet -->
                 <link href="{% static 'vendorwebcss/css/bootstrap.min.css'%}" rel="stylesheet">
             
                 <!-- Template Stylesheet -->
                 <link href="{% static 'vendorwebcss/css/style.css'%}" rel="stylesheet">

                 <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">
   
             </head>
             
             <body data-bs-spy="scroll" data-bs-target=".navbar" data-bs-offset="51">
            
             
                 <!-- JavaScript Libraries -->
                <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
                 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
                 <script src="{% static 'vendorwebcss/lib/wow/wow.min.js'%}"></script>
                 <script src="{% static 'vendorwebcss/lib/easing/easing.min.js'%}"></script>
                 <script src="{% static 'vendorwebcss/lib/waypoints/waypoints.min.js'%}"></script>
                 <script src="{% static 'vendorwebcss/lib/typed/typed.min.js'%}"></script>
                 <script src="{% static 'vendorwebcss/lib/counterup/counterup.min.js'%}"></script>
                 <script src="{% static 'vendorwebcss/lib/owlcarousel/owl.carousel.min.js'%}"></script>
                 <script src="{% static 'vendorwebcss/lib/isotope/isotope.pkgd.min.js'%}"></script>
                 <script src="{% static 'vendorwebcss/lib/lightbox/js/lightbox.min.js'%}"></script>
             
                 <!-- Template Javascript -->
                 <script src="{% static 'vendorwebcss/js/main.js'%}"></script>
             </body>

             {%endif%}
             
             </html>





