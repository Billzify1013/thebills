{% extends "base.html" %}
{% block content %}



{% load static %}
<html
  lang="en"
  class="light-style layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path="{% static 'undercss/assets/'%}"
  data-template="vertical-menu-template-free"
>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <title>Dashboard - Analytics | Sneat - Bootstrap 5 HTML Admin Template - Pro</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'undercss/assets/img/favicon/favicon.ico'%}" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="{% static 'undercss/assets/vendor/fonts/boxicons.css'%}" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="{% static 'undercss/assets/vendor/css/core.css'%}" class="template-customizer-core-css'%}" />
    <link rel="stylesheet" href="{% static 'undercss/assets/vendor/css/theme-default.css'%}" class="template-customizer-theme-css'%}" />
    <link rel="stylesheet" href="{% static 'undercss/assets/css/demo.css'%}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="{% static 'undercss/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css'%}" />

    <link rel="stylesheet" href="{% static 'undercss/assets/vendor/libs/apex-charts/apex-charts.css'%}" />

    {% comment %} <link rel="stylesheet" href="{% static 'undercss/assets/vendor/libs/spinkit/spinkit.css'%}" /> {% endcomment %}

    <!-- Page donwload link to pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <!-- Helpers -->
    <script src="{% static 'undercss/assets/vendor/js/helpers.js'%}"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="{% static 'undercss/assets/js/config.js'%}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style type="text/css">
        body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}

.invoice-container {
    width: 100%;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.1);
    padding: 30px;
}

.header img,
.footer img {
    width: 100%;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
}

.invoice-details {
    display: flex;
    justify-content: space-between;
    padding-bottom: 10px;
    margin-bottom: 10px;
}

.left h1 {
    color: #333;
    margin-top: 0;
}

.client-details h2,
.invoice-items h2,
.totals p {
    margin-top: 0;
}

.right p {
    margin: 2px 0;
}

.invoice-items,
.totals {
    border-bottom: 1px solid #ddd;
    padding-bottom: 0px;
    margin-bottom: 10px;
}

.item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1px;
}

.item p {
    margin: 0;
}

.totals {
    display: flex;
    justify-content: space-between;
}

.footer img {
    border-bottom-left-radius: 8px;
    border-bottom-right-radius: 8px;
}

    </style>
</head>
  </head>
    

<body>

    
{% if messages%}
{% for msg in messages %}
<div class="container mt-5">
    <!-- Success Alert -->
    {% if msg.tags == 'success' %}
    <div id="success-alert" class="alert alert-success alert-dismissible" role="alert">
        {{msg}}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {%else%}
    <div id="success-alert" class="alert alert-danger alert-dismissible" role="alert">
        {{msg}}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {%endif%}
</div>
{%endfor%}

<script>
    $(document).ready(function() {
        // Fade out the alert after 5 seconds (5000 milliseconds)
        setTimeout(function() {
            $("#success-alert").fadeTo(500, 0).slideUp(500, function(){
                $(this).remove(); 
            });
        }, 2000);
    });
</script>
{%endif%}

    
    
    <div class=" row">
        <div class="col-2">
        <input type=button value="Back" class="btn btn-outline-warning" onClick="javascript:history.go(-1);">
        </div>
        <div class="col-6">
          {% if request.session.permissions.fce %}
     <form  action="{% url 'cancelroom' %}" method="post">
        {% csrf_token %}
            {%for data in invoice_data%}
            <input type="hidden" name="roomno" value="{{data.customer.roomno}}" />
            <input type="hidden" name="invoice_id" value="{{data.id}}" />
            <input type="hidden" name="guest_id" value="{{data.customer.id}}" />
            {%endfor%} 
    <button class="btn btn-danger float-end  me-3" type="submit">Cancel Booking & Delete Folio</button>
     </form>
     {%endif%}
    </div>
    <div class="col-4">

   
    <button class="btn btn-primary w-100  float-end"  type="" data-bs-toggle="modal"
    data-bs-target="#backDropModalcheckout">Checkout Room & Save Invoice</button>
  

    

</div>
    </div>
        <div class="invoice-container mt-3" id="invoice" >
            <div class="header" style="margin-top:-30px">
                <div class="row">
                    
                    <div class="col-10">
                      
               
            </div>
            <div class="col-2 pt-4">
              <div class="dropdown  ms-2">
                <button
                  class="btn btn-light shadow"
                  type="button"
                  id="cardOpt3"
                  data-bs-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                <b><i class='bx bxs-edit'></i> edit</b>
                </button>
                <div class="dropdown-menu dropdown-menu-end" aria-labelledby="cardOpt3">
                  
                  {%for data in invoice_data%}
                  <form action="{%url 'openposforroom' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="invcid" value="{{data.id}}" style="display:none"/>
                    <input type="hidden" name="roomno" value="{{data.room_no}}" style="display:none"/>
                  <button class="dropdown-item btn" type="submit" href=""><i class='bx bx-sitemap'></i> Add Service</button>
                  
                  </form>
                  <hr class="mt-0 mb-0">
                  <a class="btn dropdown-item " href="{% url 'guestregform' id=data.customer.id %}"><i class='bx bx-id-card mb-1'></i> Registration Form</a>
                  <hr class="mt-0 mb-0">
                  <a class="btn dropdown-item " href="{% url 'changeroompage' id=data.id %}"><i class='bx bx-exclude'></i> Change Room</a>
                  <hr class="mt-0 mb-0">
                  
                  <a class="btn dropdown-item " data-bs-toggle="modal" data-bs-target="#backDropModal"><i class='bx bxl-paypal'></i> Add Payment</a>
                  <hr class="mt-0 mb-0">
                  
                  <a class="btn dropdown-item" id="billToCompanyBtn" data-bs-toggle="modal" data-bs-target="#billToCompanyModal">
                    <i class='bx bxl-paypal'></i> Bill To Company
                  </a><hr class="mt-0 mb-0">

                  <a class="btn dropdown-item" href="#" style="text-decoration:none" data-bs-toggle="modal"
                                      data-bs-target="#basicModal" onclick="getroomnumberpopup({{ i.roomno.room_name }}, {{ i.id }})">
                                      <i class='bx bxs-file-plus'></i> Add more guest</a><hr class="mt-0 mb-0">

                  <a class="btn dropdown-item" href="#"  data-bs-toggle="modal"
                  data-bs-target="#basicModalextends">
                  <i class='bx bxs-skip-next-circle'></i> Extend All Room Check-In
                  </a><hr class="mt-0 mb-0">

                  <a class="btn dropdown-item" href="#"  data-bs-toggle="modal"
                  data-bs-target="#basicModalecheckout">
                 <i class='bx bxs-exit' ></i> Check-Out Single Room  
                  </a>
                  <hr class="mt-0 mb-0">
                  <a class="btn dropdown-item " href="{% url 'proformainvoice' id=data.customer.id %}"><i class='bx bx-id-card mb-1'></i> Pro Forma Invoice</a>
                  <hr class="mt-0 mb-0">
                  <a class="btn dropdown-item " href="{% url 'guest_logs' id=data.customer.id %}"><i class='bx bxl-blogger'></i> logs</a>
                  
                  
                  {%endfor%}
                
               </div>

                  
              </div>
            </div>
            
          </div>
        
        </div>
            <div class="invoice-details">{%for data in invoice_data%}
                
                <div class="center m-4 mb-0">
                  <h6>Guest Information</h6>
                  <div class="row">
                    <div class="col-6">
                      <input type="hidden" value="{{data.customer.guestname}}" id="guestsnames">
                      <input type="hidden" value="{{data.customer.guestphome}}" id="guestsphon">
                      <input type="hidden" value="{{data.customer.roomno}}" id="guestroom">
                      <p>Name: {{data.customer.guestname}}  </p>
                <p>Phone: {{data.customer.guestphome}}</p>
                <p>Room NO: {{data.customer.roomno}}</p>
                    </div>
                    <div class="col-6">
                      <p>Primary-Meal_plan: {{data.customer.rate_plan}}</p>
                <p>Source: {{data.customer.channel}}</p>
                <p>Guests: T:{{data.customer.noofguest}},A:{{data.customer.adults}},C:{{data.customer.children}}</p>
                    </div>
                  </div>
                    
                <p>Check-In Date : {{data.customer.checkindate}}</p>
                <p>Check-Out Date: {{data.customer.checkoutdate}} <span style="font-size:10px">Checkout time not update please check it</span></p>
                
                {%if data.customer.extend%}
                <p class="text-warning">Room Extend</p>
                <p>{{data.customer.extend_decription}}</p>
                {%endif%}
                {%if data.customer_gst_number%}
                <p>gstin: {{data.customer_gst_number}}</p>
                <p>Company: {{data.customer_company}}</p>
                {%endif%}
                </div>
                {%endfor%}
                
            </div>
            
           
            
        
           
            <div class="invoice-items" >
                <div class="table-responsive text-nowrap" >
                   
                    <div class="cool-3 float-end">
                      <!-- Filter Dropdown -->
                      <select class="form-control" name="invoiceitemid" required>
                        <option value="">Apply Filters</option>
                        <option id="showCheckedOutBtn">Show Checked-Out</option>
                        <option id="showCheckedInBtn">Show Checked-In</option>
                        <option id="showCheckOut">Show ExtendRoom-In</option>
                        <option id="clearFilterBtn">Clear Filter</option>
                      </select>
                    </div>
                    
                    <table class="table">
                      <thead class="table-light">
                        <tr>
                          <th style="width: 5px !important;">SR.</th>
                          <th>Services</th>
                          {% for data in invoice_data %}
                            {% if data.taxtype == 'GST' %}
                              <th>Cgst</th>
                              <th>Sgst</th>
                            {% else %}
                              <th>Igst</th>
                            {% endif %}
                          {% endfor %}
                          <th>HSN/SAC</th>
                          <th>Price</th>
                          <th>Qty/Day</th>
                          <th>Total<br>(incl/Qty,tax,discount)</th>
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody id="invoiceItemsList">
                        {% for iteams in invoiceitemdata %}
                          <tr class="invoice-item {% if iteams.is_checkout == True %} checked-out {% else %} not-checked-out {% endif %} {% if iteams.is_room == False %} not-room-item {% else %} is-room-item {% endif %}  {% if iteams.is_extend == False %} not-room-item {% else %} is-extendroom-item {% endif %}">
                            
                            <td >{{forloop.counter}}</td>
                            <td style="font-size:18px">
                              {{ iteams.description }}<br>
                              <p style="font-size:12px">{{ iteams.mdescription }}</p>
                            </td>
                            {% for data in invoice_data %}
                              {% if data.taxtype == 'GST' %}
                                <td style="font-size:18px">{{ iteams.sgst_rate }} % </td>
                                <td style="font-size:18px">{{ iteams.sgst_rate }} % </td>
                              {% else %}
                                {% if iteams.sgst_rate == 2.50 %}
                                  <td style="font-size:18px"> 5% </td>
                                {% else %}
                                  <td style="font-size:18px">{{ iteams.sgst_rate|add:iteams.sgst_rate }}% </td>
                                {% endif %}
                              {% endif %}
                            {% endfor %}
                            <td style="font-size:18px">{{ iteams.hsncode }}</td>
                            <td style="font-size:18px">{{ iteams.price }}</td>
                            <td style="font-size:18px">{{ iteams.quantity_likedays }}</td>
                            <td style="font-size:18px">{{ iteams.total_amount }}</td>
                            <td>
                              {% if iteams.is_room == False and iteams.mdescription != 'Extra Charges' %}
                             

                                  <div class="dropdown">
                                    <button
                                      class="btn "
                                      type="button"
                                      id="cardOpt6"
                                      data-bs-toggle="dropdown"
                                      aria-haspopup="true"
                                      aria-expanded="false"
                                    >
                                    <span class="badge bg-label-danger"><i class='bx bxs-trash'></i></span>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="cardOpt6">
                                      <form action="{% url 'deleteitemstofolio' %}" method="post" style="float:left">
                                      {% csrf_token %}
                                        <div>
                                        {% for data in invoice_data %}
                                    <input type="hidden" name="invoiceid" value="{{ data.id }}" />
                                  {% endfor %}
                                  <input type="hidden" name="invoiceitemsid" value="{{ iteams.id }}" />
                                        <span class="p-2">Item Quantity</span>
                                      <input type="number" name="qty" value={{ iteams.quantity_likedays }} required  class="form-control mt-2 ms-2 w-75" /></div>
                                      <button type="submit" class="btn btn-primary w-75 m-2">delete</button>
                                    </div>
                                  </form>
                                  </div>
                                {% comment %} </form> {% endcomment %}
                              {% endif %}
                              {% if iteams.is_checkout == True %}
                                <span class="badge bg-label-success"><i class='bx bxs-check-shield'></i> Check-Out</span>
                              {% endif %}

                              {% if iteams.is_extend == True %}
                                <span class="badge bg-label-warning"><i class='bx bxs-check-shield'></i> Extend Room</span>
                              {% endif %}

                              {% if iteams.is_room == True and iteams.is_extend == False %}
                              <button class="btn kot-btn" type="button" data-bs-toggle="modal" 
                              data-bs-target="#basicModalextendsitem" 
                              onclick="setidanddate('{{iteams.id}}','{{iteams.checkout_date}}')"
                              >
                            <span class="badge bg-label-info"> Extend</span>
                          </button>

                              {%endif%}
                              <!-- KOT Button -->
                              <button class="btn kot-btn" type="button" data-bs-toggle="modal" 
                                      data-bs-target="#kotModal" 
                                      data-description="{{ iteams.description }}" 
                                      data-mdescription="{{ iteams.mdescription }}"
                                      data-hsncode="{{ iteams.hsncode }}"
                                      data-price="{{ iteams.price }}"
                                      data-tax="{% if iteams.sgst_rate|add:iteams.sgst_rate == 4 %} 5 {% else %} {{ iteams.sgst_rate|add:iteams.sgst_rate }} {% endif %}" 
                                      data-quantity="{{ iteams.quantity_likedays }}"
                                      data-total="{{ iteams.total_amount }}">
                                <span class="badge bg-label-info"><i class='bx bx-printer'></i> KOT</span>
                              </button>
                            </td>
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                    
                    <!-- JS to handle filtering using the dropdown -->
                    <script>
                      // Get the dropdown and add event listener
                      document.querySelector('select[name="invoiceitemid"]').addEventListener('change', function() {
                        let filterValue = this.value;  // Get selected filter option
                    
                        // Get all invoice item rows
                        let items = document.querySelectorAll('.invoice-item');
                        
                        // Loop through all items and hide or show based on the selected filter
                        items.forEach(function(item) {
                          // By default show all items
                          item.style.display = 'table-row'; 
                          
                          // Apply filter based on the selected value
                          if (filterValue == 'Show Checked-Out' && !item.classList.contains('checked-out')) {
                            item.style.display = 'none';  // Hide non-checked-out items
                          } else if (filterValue == 'Show Checked-In' && (item.classList.contains('checked-out') || !item.classList.contains('is-room-item'))) {
                            item.style.display = 'none';  // Hide checked-out and non-room items
                          } else if (filterValue == 'Clear Filter' && item) {
                            item.style.display = 'table-row';  // Show all items again
                          }else if (filterValue == 'Show ExtendRoom-In' && (item.classList.contains('extend-out') || !item.classList.contains('is-extendroom-item'))) {
                            item.style.display = 'none';  // Hide checked-out and non-room items
                          }
                        });
                      });
                    </script>
                    
                    
                </div>
                <div class="row">
                    <div class="col-5">
                        
                        
                        {% comment %} <form action="{%url 'openposforroom' %}" method="post">
                          {% csrf_token %}
                          {%for data in invoice_data%}
                          <input type="hidden" name="invcid" value="{{data.id}}" />
                          <input type="hidden" name="roomno" value="{{data.room_no}}" />
                        
                        <button class="btn btn-warning w-100 m-2"  type="submit"><i class='bx bx-sitemap'></i> Add Services</button>
                        </form> 
                         {%endfor%}{% endcomment %}

                        <button class="btn btn-primary w-100 m-2"    data-bs-toggle="modal"
                        data-bs-target="#backDropModal"><i class='bx bxl-paypal'></i> Add Payment</button>
                     
                     
                        
                        <div class="container mt-2">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                  Payments
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Date</th>
                                            <th>Amount</th>
                                            <th> Mode</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {%for payment in invcpayments%}
                                        <tr>
                                            <td>{{payment.payment_date}}
                                                
                                            </td>
                                            <td><span class="text w-50">
                                              <a class="btn w-100 m-2"    data-bs-toggle="modal"
                        data-bs-target="#editpaymnent" onClick="setpaymentedit('{{payment.id}}','{{payment.payment_amount}}','{{payment.payment_mode}}','{{payment.transaction_id}}','{{payment.descriptions}}')">
                        {{payment.payment_amount}}
                                                </a>
                                            </span></td>
                                            <td><span class="text w-50">{{payment.payment_mode}}</span>
                                            
                                                {%if payment.transaction_id%}
                                                <span class="text w-25" style="font-size:12px">D:{{payment.transaction_id}}<br>
                                                    
                                                  {%elif payment.descriptions%}
                                                  C:{{payment.descriptions}}</span>
                                                {%endif%}</td>
                                        </tr>
                                        {%endfor%}
                                        
                                    </tbody>
                                </table>
                            </div>
                        </div>

                       
                        
                    </div> 

                    <div class="col-1"></div>

                <div class="card col-6 shadow-none mb-0 w-50  " style="margin-top:0px">
                    {%for data in invoice_data%}
                    <span>Payment Status</span>
                    <span class="badge bg-label-success me-1 col-2">Paid</span>
                    <span>Total Paid Amount:₹ <b>{{data.accepted_amount}}</b> </span>
                    <hr>
                    <span class="badge bg-label-warning me-1 float-end col-2">Due</span>
                        <span>Overall Due Amount:₹ <b>{{data.Due_amount}}</b> </span>
                    <hr>
                        
                    
                    
                      
                      <li class="list-group-item" style="font-size:13px">
                        <span class="text w-50">Total</span> 
                        <span class="text float-end">₹{{data.total_item_amount}}</span><br>
                        <span class="text w-50">Discount</span> 
                        <span class="text float-end">₹ {{data.discount_amount}}</span><br>
                        <span class="text w-50">Subtotal</span> 
                        <span class="text float-end">₹ {{data.subtotal_amount}}</span><br>

                        {%for data in invoice_data%}
                                {%if data.taxtype == 'GST'%}
                                    <span class="text w-50">Cgst Total</span> 
                                    <span class="text float-end">₹ {{sstamounts}}</span><br>
                                    <span class="text w-50">Sgst Total</span> 
                                    <span class="text float-end">₹ {{gstamounts}}</span>
                                {%else%}
                                <span class="text w-50">Igst Total</span> 
                                    <span class="text float-end">₹ {{istamts}}</span>

                                {%endif%}
                        {%endfor%}
                        
                      </li> 
                      
                      
                       
                      <li class="list-group-item">
                        <span class="text w-50"><b>Grand Total</b></span> 
                        <span class="text float-end"><b>₹ {{data.grand_total_amount}}</b></span>
                      </li> 
                      {%endfor%}
                    </ul>
                    <span class="mt-2 mb-2 text " style="font-size:9px"><i class='bx bxs-info-circle'></i>Rooms have discount, so their tax calculation are done after applying the discount.</span>
                
                </div>


                 <!--tax slab working here-->
                 <div class="container mt-2">
                  <div class="table-responsive">
                      <table class="table table-bordered">
                        Tax Descriptions
                          <thead class="thead-light">
                              <tr>
                                  <th>Tax </th>
                                  <th>CGST</th>
                                  <th>SGST</th>
                                  <th>CGST Amount</th>
                                  <th>SGST Amount</th>
                                  <th> Total Amount</th>
                              </tr>
                          </thead>
                          <tbody>
                              {%for data in taxelab%}
                              <tr>
                                  <td>{{data.tax_rate_name}}
                                      
                                  </td>
                                  <td><span class="text w-50">{{data.cgst}} %</span></td>
                                  <td><span class="text w-50">{{data.sgst}}%</span></td>
                                  <td><span class="text w-50">₹ {{data.sgst_amount}} </span></td>
                                  <td><span class="text w-50">₹ {{data.sgst_amount}}</span></td>
                                  <td><span class="text w-50">₹ {{data.total_amount}}</span></td>
                              </tr>
                              {%endfor%}
                              
                          </tbody>
                      </table>
                  </div>
              </div>
                  
                
            </div>
            </div>
       
            </div>
           
            {% if loyltydata%}
            <div class="card mt-3" >
               <h3 class="m-3 text-primary">Reward Program</h3>
               {%for i in loyltydata%}
                <h5 class="m-3">You will give {{i.loylty_rate_prsantage}}% loyalty points on the total billing amount. Are you sure you want to award loyalty points to this customer? Please On the button</h5>
               {%endfor%}
               

            
               <h6 class="m-2 ms-3"><i class='bx bxl-jquery text-primary me-2'></i>An SMS will automatically be sent to the Your guest.</h6>
               <h6 class="m-2 ms-3"><i class='bx bxl-jquery text-primary me-2'></i> informing them about the Your loyalty program.,</h6>
               <h6 class="m-2 ms-3"><i class='bx bxl-jquery text-primary me-2'></i> helping you build a strong and proud relationship with your customers.</h6>
               <h6 class="m-2 ms-3"><i class='bx bxl-jquery text-primary me-2'></i> Enhance Customer Lifetime Value.</h6>
               <h6 class="m-2 ms-3"><i class='bx bxl-jquery text-primary me-2'></i>Create Personalized Marketing Campaigns.</h6>
               <h6 class="m-2 ms-3"><i class='bx bxl-jquery text-primary me-2'></i>Build a Loyal Customer Community.</h6>
               <h6 class="m-2 ms-3"><i class='bx bxl-jquery text-primary me-2'></i>Boost Sales During Slow Periods.</h6>
               <h6 class="m-2 ms-3"><i class='bx bxl-jquery text-primary me-2'></i>Provide Exclusive VIP Experiences.</h6>
            </div>
            {%endif%}
            
      
           
    
        

   
</body>


    </html>

{% comment %}     

    <div class="modal fade" id="kotModal" tabindex="-1" aria-labelledby="kotModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="kotModalLabel">Hotel Order Token (HOT)</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                  <!-- Guest Details Section -->
                  <div>
                      <p><strong>Guest Name:</strong> <span id="guestName"></span></p>
                      <p><strong>Guest Phone:</strong> <span id="guestPhone"></span></p>
                      <p><strong>Room:</strong> <span id="guestRoom"></span> (Primary Room)</p>
                  </div>
                  <!-- HOT Header -->
                  <div style="text-align: center;">
                      <h6>Hotel Name</h6>
                      <p>Hotel Order Token (HOT)</p>
                      <p>Order Date & Time: <span id="orderDate"></span></p>
                  </div>
                  <!-- HOT Table -->
                  <table class="table table-bordered">
                      <thead>
                          <tr>
                              <th>Item</th>
                              <th>Qty</th>
                              <th>Price</th>
                              <th>Tax%</th>
                              <th>Total</th>
                          </tr>
                      </thead>
                      <tbody id="kotTableBody"></tbody>
                  </table>
                  <!-- Total Amount -->
                  <div style="text-align: right; margin-top: 10px;">
                      <strong>Grand Total: ₹<span id="grandTotal"></span></strong>
                  </div>
                  <!-- Guest Signature Section -->
                  <div style="margin-top: 20px; text-align: left;">
                      <p><strong>Guest Signature:</strong></p>
                      <div style="border: 1px solid #ccc; width: 100%; height: 50px;"></div>
                  </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-primary" id="toggleDataBtn">Show Full Data</button>
                  <button type="button" class="btn btn-primary" onclick="printOrDownload('print')">Print</button>
              </div>
          </div>
      </div>
  </div>
  
  <script>
    let showFullData = false; // Toggle state for full data

    document.addEventListener("DOMContentLoaded", function () {
        const kotTableBody = document.getElementById("kotTableBody");
        const toggleDataBtn = document.getElementById("toggleDataBtn");
    
        // Attach event listener to all HOT buttons
        document.querySelectorAll(".kot-btn").forEach(button => {
            button.addEventListener("click", function () {
                // Extract single item's data
                const description = this.getAttribute("data-description");
                const mdescription = this.getAttribute("data-mdescription");
                const quantity = parseInt(this.getAttribute("data-quantity"));
                const price = parseFloat(this.getAttribute("data-price")).toFixed(2);
                const total = parseFloat(this.getAttribute("data-total")).toFixed(2);
                const tax = parseFloat(this.getAttribute("data-tax")).toFixed(2);
    
                const guestName = document.getElementById("guestsnames").value;
                const guestPhone = document.getElementById("guestsphon").value;
                const guestRoom = document.getElementById("guestroom").value;
    
                // Set current date and time
                const currentDate = new Date();
                const formattedDate = currentDate.toLocaleDateString();
                const formattedTime = currentDate.toLocaleTimeString();
    
                // Populate guest details
                document.getElementById("guestName").textContent = guestName;
                document.getElementById("guestPhone").textContent = guestPhone;
                document.getElementById("guestRoom").textContent = guestRoom;
    
                document.getElementById("orderDate").textContent = `${formattedDate}, ${formattedTime}`;
    
                // Populate table with single item
                kotTableBody.innerHTML = `
                    <tr>
                        <td>${description} ${mdescription}</td>
                        <td>${quantity}</td>
                        <td>₹${price}</td>
                        <td>${tax} %</td>
                        <td>₹${total}</td>
                    </tr>
                `;
                document.getElementById("grandTotal").textContent = total;
    
                showFullData = false; // Reset toggle
                toggleDataBtn.textContent = "Show Full Data";
            });
        });
    
        // Toggle between single item and full data
        toggleDataBtn.addEventListener("click", function () {
            if (showFullData) {
                // Revert to single item
                document.querySelector(".kot-btn").click(); // Simulate click to load single item data
            } else {
                // Populate table with full invoice data
                const invoiceItems = document.querySelectorAll(".kot-btn");
                kotTableBody.innerHTML = ""; // Clear table
                let grandTotal = 0;
    
                invoiceItems.forEach(button => {
                  const description = button.getAttribute("data-description");
                  const mdescription = button.getAttribute("data-mdescription");
                  const quantity = parseInt(button.getAttribute("data-quantity"));
                  const price = parseFloat(button.getAttribute("data-price"));
                  const total = parseFloat(button.getAttribute("data-total"));
                  const tax = parseFloat(button.getAttribute("data-tax"));
      
                  // Validate that the required attributes are valid numbers
                  if (isNaN(quantity) || isNaN(price) || isNaN(total) || isNaN(tax)) {
                      console.error("Invalid data for item:", button); // Log an error for the problematic button
                      return; // Skip this item if any value is invalid
                  }grandTotal += parseFloat(total);

                    
    
                    kotTableBody.innerHTML += `
                        <tr>
                            <td>${description} ${mdescription} </td>
                            <td>${quantity}</td>
                            <td>₹${price}</td>
                            <td>${tax} %</td>
                            <td>₹${total}</td>
                        </tr>
                    `;
                });
    
                document.getElementById("grandTotal").textContent = grandTotal.toFixed(2);
            }
    
            showFullData = !showFullData; // Toggle state
            toggleDataBtn.textContent = showFullData ? "Show Less Data" : "Show Full Data";
        });
    });
    
    // Function to handle Print and Download actions
    // Function to handle Print and Download actions
// Function to handle Print and Download actions
function printOrDownload(action) {
  const guestName = document.getElementById("guestName").textContent;
  const guestPhone = document.getElementById("guestPhone").textContent;
  const guestRoom = document.getElementById("guestRoom").textContent;
  const orderDate = document.getElementById("orderDate").textContent;
  const kotTableContent = document.getElementById("kotTableBody").innerHTML;
  const grandTotal = document.getElementById("grandTotal").textContent;

  const content = `
      <div style="font-family: Arial, sans-serif; padding: 20px;">
          <div style="text-align: center; margin-bottom: 20px;">
              <h5>Hotel Order Token (HOT)</h5>
              <p><strong>Guest Name:</strong> ${guestName}</p>
              <p><strong>Guest Phone:</strong> ${guestPhone}</p>
              <p><strong>Room:</strong> ${guestRoom} (Primary Room)</p>
              <hr />
              
              <p>Hotel Order Token (HOT)</p>
              <p>Order Date & Time: ${orderDate}</p>
              <hr />
              <table style="width: 100%; border-collapse: collapse; margin-top: 20px; border: 1px solid #ccc;">
                  <thead>
                      <tr>
                          <th style="padding: 8px; border: 1px solid #ccc; text-align: left;">Item</th>
                          <th style="padding: 8px; border: 1px solid #ccc; text-align: left;">Qty</th>
                          <th style="padding: 8px; border: 1px solid #ccc; text-align: left;">Price</th>
                          <th style="padding: 8px; border: 1px solid #ccc; text-align: left;">Tax</th> <!-- Add Tax column -->
                          <th style="padding: 8px; border: 1px solid #ccc; text-align: left;">Total</th>
                      </tr>
                  </thead>
                  <tbody>
                      ${kotTableContent}
                  </tbody>
              </table>
              <div style="text-align: right; margin-top: 20px;">
                  <strong>Grand Total: ₹${grandTotal}</strong>
              </div>
              <div style="margin-top: 20px; text-align: left;">
                  <p><strong>Guest Signature:</strong></p>
                  <div style="border: 1px solid #ccc; width: 100%; height: 50px;"></div>
              </div>
          </div>
      </div>
  `;

  if (action === 'print') {
      const newWindow = window.open("", "_blank");

      // Write content to new window
      newWindow.document.write(`
          <html>
          <head>
              <style>
                  @media print {
                      @page {
                          size: 4in auto; /* 4-inch width */
                          margin-top: 50px; /* 50px top margin */
                      }

                      body {
                          margin: 0;
                          padding: 0;
                          font-family: Arial, sans-serif;
                      }

                      .modal-content {
                          width: 4in;
                          margin: 0;
                          padding: 20px;
                          box-shadow: none;
                      }

                      table {
                          width: 100%;
                          border-collapse: collapse;
                      }

                      th, td {
                          padding: 8px;
                          border: 1px solid #ccc;
                          text-align: left;
                      }

                      .modal-header h5 {
                          font-size: 12px;
                      }

                      .modal-body {
                          padding: 0;
                      }

                      /* Prevent full-screen size and keep content in 4-inch width */
                      .print-content {
                          width: 4in;
                          margin: 0 auto; /* Center the content */
                          padding: 10px;
                          box-sizing: border-box;
                      }
                  }
              </style>
          </head>
          <body>
              <div class="print-content">
                  ${content}
              </div>
          </body>
          </html>
      `);

      newWindow.document.close();
      newWindow.print();
  } else if (action === 'download') {
      const pdf = new jsPDF();
      pdf.html(content, {
          callback: function (pdf) {
              pdf.save("HOT.pdf");
          },
          x: 10,
          y: 10,
      });
  }
}


    
  </script> {% endcomment %}
  


  <div class="modal fade" id="kotModal" tabindex="-1" aria-labelledby="kotModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="kotModalLabel">Hotel Order Token (HOT)</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Guest Details Section -->
          <div>
            <p><strong>Guest Name:</strong> <span id="guestName"></span></p>
            <p><strong>Guest Phone:</strong> <span id="guestPhone"></span></p>
            <p><strong>Room:</strong> <span id="guestRoom"></span> (Primary Room)</p>
          </div>
          <!-- HOT Header -->
          <div style="text-align: center;">
            <h6>Hotel Name</h6>
            <p>Hotel Order Token (HOT)</p>
            <p>Order Date & Time: <span id="orderDate"></span></p>
          </div>
          <!-- HOT Table -->
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Item</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Tax%</th>
                <th>Total</th>
                <th>Select</th>
              </tr>
            </thead>
            <tbody id="kotTableBody"></tbody>
          </table>
          <!-- Total Amount -->
          <div style="text-align: right; margin-top: 10px;">
            <strong>Grand Total: ₹<span id="grandTotal">0.00</span></strong>
          </div>
          <!-- Guest Signature Section -->
          <div style="margin-top: 20px; text-align: left;">
            <p><strong>Guest Signature:</strong></p>
            <div style="border: 1px solid #ccc; width: 100%; height: 50px;"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="toggleDataBtn">Show Full Data</button>
          <button type="button" class="btn btn-primary" onclick="printOrDownload('print')">Print</button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    let showFullData = false; // Toggle state for full data
    let selectedItems = []; // Store selected items for calculation and printing
  
    document.addEventListener("DOMContentLoaded", function () {
      const kotTableBody = document.getElementById("kotTableBody");
      const toggleDataBtn = document.getElementById("toggleDataBtn");
  
      // Function to validate data and return defaults if needed
      function getValidData(attribute, defaultValue = 0) {
        const value = parseFloat(attribute);
        return isNaN(value) ? defaultValue : value;
      }
  
      // Attach event listener to all HOT buttons
      document.querySelectorAll(".kot-btn").forEach(button => {
        button.addEventListener("click", function () {
          // Extract single item's data
          const description = this.getAttribute("data-description") || '';
          const mdescription = this.getAttribute("data-mdescription") || '';
          const quantity = getValidData(this.getAttribute("data-quantity"), 0);
          const price = getValidData(this.getAttribute("data-price"), 0).toFixed(2);
          const total = getValidData(this.getAttribute("data-total"), 0).toFixed(2);
          const tax = getValidData(this.getAttribute("data-tax"), 0).toFixed(2);
  
          // Set guest details
          const guestName = document.getElementById("guestsnames").value || 'Unknown Guest';
          const guestPhone = document.getElementById("guestsphon").value || 'Unknown Phone';
          const guestRoom = document.getElementById("guestroom").value || 'Unknown Room';
  
          // Set current date and time
          const currentDate = new Date();
          const formattedDate = currentDate.toLocaleDateString();
          const formattedTime = currentDate.toLocaleTimeString();
  
          // Populate guest details
          document.getElementById("guestName").textContent = guestName;
          document.getElementById("guestPhone").textContent = guestPhone;
          document.getElementById("guestRoom").textContent = guestRoom;
  
          document.getElementById("orderDate").textContent = `${formattedDate}, ${formattedTime}`;
  
          // Populate table with a single item
          kotTableBody.innerHTML = ""; // Clear previous table data
  
          if (description) {
            kotTableBody.innerHTML += `
              <tr>
                <td>${description} ${mdescription}</td>
                <td>${quantity}</td>
                <td>₹${price}</td>
                <td>${tax} %</td>
                <td>₹${total}</td>
                <td><input type="checkbox" class="item-checkbox" checked data-description="${description}" data-price="${price}" data-total="${total}" data-quantity="${quantity}" data-tax="${tax}" /></td>
              </tr>
            `;
            document.getElementById("grandTotal").textContent = total; // Update grand total
          }
  
          showFullData = false; // Reset toggle
          toggleDataBtn.textContent = "Show Full Data";
        });
      });
  
      // Toggle between single item and full data
      toggleDataBtn.addEventListener("click", function () {
        if (showFullData) {
          // Revert to single item view
          document.querySelector(".kot-btn").click(); // Simulate click to load single item data
        } else {
          // Populate table with full invoice data
          const invoiceItems = document.querySelectorAll(".kot-btn");
          kotTableBody.innerHTML = ""; // Clear table
          let grandTotal = 0;
  
          invoiceItems.forEach(button => {
            const description = button.getAttribute("data-description") || '';
            const mdescription = button.getAttribute("data-mdescription") || '';
            const quantity = getValidData(button.getAttribute("data-quantity"), 0);
            const price = getValidData(button.getAttribute("data-price"), 0).toFixed(2);
            const total = getValidData(button.getAttribute("data-total"), 0).toFixed(2);
            const tax = getValidData(button.getAttribute("data-tax"), 0).toFixed(2);
  
            if (description) { // Skip items with no description
              grandTotal += parseFloat(total);
  
              kotTableBody.innerHTML += `
                <tr>
                  <td>${description} ${mdescription}</td>
                  <td>${quantity}</td>
                  <td>₹${price}</td>
                  <td>${tax} %</td>
                  <td>₹${total}</td>
                  <td><input type="checkbox" class="item-checkbox" data-description="${description}" data-price="${price}" data-total="${total}" data-quantity="${quantity}" data-tax="${tax}" /></td>
                </tr>
              `;
            }
          });
  
          document.getElementById("grandTotal").textContent = grandTotal.toFixed(2);
        }
  
        showFullData = !showFullData; // Toggle state
        toggleDataBtn.textContent = showFullData ? "Show Less Data" : "Show Full Data";
      });
  
      // Event listener for checkboxes to select and calculate total for selected items
      kotTableBody.addEventListener("change", function (e) {
        if (e.target && e.target.matches(".item-checkbox")) {
          const selectedCheckboxes = document.querySelectorAll(".item-checkbox:checked");
          let total = 0;
          selectedItems = []; // Clear previous selected items
  
          selectedCheckboxes.forEach(checkbox => {
            const description = checkbox.getAttribute("data-description");
            const price = parseFloat(checkbox.getAttribute("data-price"));
            const quantity = parseInt(checkbox.getAttribute("data-quantity"));
            const tax = parseFloat(checkbox.getAttribute("data-tax"));
            const totalItem = parseFloat(checkbox.getAttribute("data-total"));
  
            selectedItems.push({
              description,
              price,
              quantity,
              tax,
              total: totalItem
            });
  
            total += totalItem; // Calculate total for selected items
          });
  
          document.getElementById("grandTotal").textContent = total.toFixed(2); // Update grand total
        }
      });
    });
  
    function printOrDownload(action) {
      let printContent = '';
      let grandTotal = 0;
    
      // Collect all checked checkboxes from the modal
      const selectedCheckboxes = document.querySelectorAll(".item-checkbox:checked");
      
      // Loop through the selected checkboxes and create print content
      selectedCheckboxes.forEach(checkbox => {
        const description = checkbox.getAttribute("data-description");
        const price = parseFloat(checkbox.getAttribute("data-price"));
        const quantity = parseInt(checkbox.getAttribute("data-quantity"));
        const tax = parseFloat(checkbox.getAttribute("data-tax"));
        const total = parseFloat(checkbox.getAttribute("data-total"));
    
        printContent += `
          <tr>
            <td>${description}</td>
            <td>${quantity}</td>
            <td>₹${price.toFixed(2)}</td>
            <td>${tax} %</td>
            <td>₹${total.toFixed(2)}</td>
          </tr>
        `;
        grandTotal += total;
      });
    
      const content = `
        <div style="font-family: Arial, sans-serif; padding: 20px;">
            <div style="text-align: center; margin-bottom: 20px;">
                <h5>Hotel Order Token (HOT)</h5>
                <p><strong>Guest Name:</strong> ${document.getElementById("guestName").textContent}</p>
                <p><strong>Guest Phone:</strong> ${document.getElementById("guestPhone").textContent}</p>
                <p><strong>Room:</strong> ${document.getElementById("guestRoom").textContent} (Primary Room)</p>
                <hr />
                <p>Hotel Order Token (HOT)</p>
                <p>Order Date & Time: ${document.getElementById("orderDate").textContent}</p>
                <hr />
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px; border: 1px solid #ccc;">
                    <thead>
                        <tr>
                            <th style="padding: 8px; border: 1px solid #ccc; text-align: left;">Item</th>
                            <th style="padding: 8px; border: 1px solid #ccc; text-align: left;">Qty</th>
                            <th style="padding: 8px; border: 1px solid #ccc; text-align: left;">Price</th>
                            <th style="padding: 8px; border: 1px solid #ccc; text-align: left;">Tax</th>
                            <th style="padding: 8px; border: 1px solid #ccc; text-align: left;">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${printContent}
                    </tbody>
                </table>
                <div style="text-align: right; margin-top: 20px;">
                    <strong>Grand Total: ₹${grandTotal.toFixed(2)}</strong>
                </div>
                <div style="margin-top: 20px; text-align: left;">
                    <p><strong>Guest Signature:</strong></p>
                    <div style="border: 1px solid #ccc; width: 100%; height: 50px;"></div>
                </div>
            </div>
        </div>
      `;
    
      if (action === 'print') {
        const newWindow = window.open("", "_blank");
        newWindow.document.write(`
          <html>
          <head>
            <style>
              @media print {
                  @page { size: 4in auto; }
                  body { margin: 0; font-family: Arial, sans-serif; }
                  .modal-content { width: 4in; padding: 20px; }
                  table { width: 100%; border-collapse: collapse; }
                  th, td { padding: 8px; border: 1px solid #ccc; }
              }
            </style>
          </head>
          <body>
              <div class="print-content">${content}</div>
          </body>
          </html>
        `);
        newWindow.document.close();
        newWindow.print();
      }
    }
    
  </script>
  
  




<!-- Modal add Payments -->
<div class="modal fade" id="backDropModal" data-bs-backdrop="static" tabindex="-1">
    <div class="modal-dialog">
        <form action="{% url 'addpaymentfolio'  %}" method="POST" class="modal-content">
            {% csrf_token %}

            {%for i in invoice_data%}
            <input type="hidden" name="invcids" value="{{i.id}}">
            
        
        <div class="modal-header">
          <h5 class="modal-title" id="backDropModalTitle">Add Payments</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col mb-3">
              <label for="nameBackdrop" class="form-label">Amount</label>
              <input
                type="text"
                name="amount"
                id="nameBackdrop"
                class="form-control"
                placeholder="Enter Amount"
                value="{{i.Due_amount}}"
                required
              />
            </div>{%endfor%}

            <div class="col mb-3">
                <label for="nameBackdrop" class="form-label">Payment Mode</label>
                <select class="form-control" name="paymentmode" required placeholder="Select Category" required>
                    
                    <option  value="cash">Cash</option>
                    <option  value="UPI">UPI</option>
                    <option  value="Cheque">Cheque</option>
                    <option  value="Card">Card</option>
                    <option  value="BankTransfer">BankTransfer</option>
                  </select>
              </div>
              
          </div>
          <div class="row">
            <div class="col mb-3">
                <label for="nameBackdrop" class="form-label">Payment Details</label>
                <input
                  type="text"
                  name="paymntdetails"
                  id="nameBackdrop"
                  class="form-control"
                  placeholder="utr,check no"
                  
                />
              </div>
  
              <div class="col mb-3">
                <label for="nameBackdrop" class="form-label">Comments</label>
                <input
                  type="text"
                  name="comment"
                  id="nameBackdrop"
                  class="form-control"
                  placeholder=""
                  
                />
              </div>
          </div>
        </div>

        
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            Close
          </button>
          <button  class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
</div>
</div>
</div>
</div>
<!--/ Bootstrap modals -->

{% comment %} bill companymodel {% endcomment %}
<!-- Modal --><div class="modal fade" id="billToCompanyModal" tabindex="-1" aria-labelledby="billToCompanyModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form id="billToCompanyForm">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="billToCompanyModalLabel">Bill To Company</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="companySelect" class="form-label">Select Company</label>
            <select id="companySelect" class="form-select" name="company_id" required>
              <option value="">Select a company</option>
              <!-- Options will be populated via AJAX -->
            </select>
          </div>

          <!-- Invoice options populated dynamically -->
          {% for data in invoice_data %}
            <input value="{{ data.id }}" type="hidden" name="invoice_id">
          {% endfor %}

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Submit</button>
        </div>
      </div>
    </form>
  </div>
</div>






<!-- Modal aCheckout -->
<div class="modal fade" id="backDropModalcheckout" data-bs-backdrop="static" tabindex="-1">
    <div class="modal-dialog">
        <form action="{% url 'checkoutroom'  %}" method="POST" class="modal-content">
            {% csrf_token %}

            {%for data in invoice_data%}
            <input type="hidden" name="roomno" value="{{data.customer.roomno}}" />
            <input type="hidden" name="invoice_id" value="{{data.id}}" />
            {%endfor%}

            {%for i in invoice_data%}
            
        
        <div class="modal-header">
          <h5 class="modal-title" id="backDropModalTitle">Checkout form</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
            
          {%endfor%}
          <div class="row">
            
            {%for data in invoice_data%}
            <input type="hidden" name="dueamount" value="{{data.Due_amount}}"/>
          {% if data.Due_amount == 0.00%}
          
          {%else%}
            <div class="col mb-3">
                <label for="nameBackdrop" class="form-label">Due Date</label>
                <input
                  type="date"
                  name="duedate"
                  id="checkindate"
                  class="form-control"
                  placeholder="utr,check no"
                  
                />
              </div>
              {%endif%}
          
              {% if data.is_ota %}
                <span class="text-primary">  This Is Prepaid Booking From OTA!</span>
              {%else%}
              <div class="col mb-3">
                <label for="nameBackdrop" class="form-label">Guest Gst Number</label>
                <input
                  type="text"
                  name="gstnumber"
                  id="nameBackdrop"
                  class="form-control"
                  placeholder=""
                  value="{{data.customer_gst_number}}"
                  
                />
              </div>

              <div class="col mb-3">
                <label for="nameBackdrop" class="form-label">Company Name</label>
                <input
                  type="text"
                  name="guestcompany"
                  id="nameBackdrop"
                  class="form-control"
                  placeholder=""
                  value="{{data.customer_company}}"
                  
                />
              </div>
              {%endif%}
              {%endfor%}
          </div>
          {%for data in invoice_data%}
          {% if data.Due_amount == 0.00%}
          <h5 class="modal-title text-success" id="">Amount Paid</h5>
          {%else%}
          <h5 class="modal-title text-warning" id="">Due Amount:{{data.Due_amount}}</h5>
          {%endif%}
          {%endfor%}

          {% if loyltydata%}
                <div class=" form-check form-switch mt-3 mb-2 border-danger" style="border:px solid red;border-radius:10px">
                    {%for i in loyltydata%}
                    <input class="form-check-input ms-1  mt-1" style="height:25px;width:60px" type="checkbox" id="flexSwitchCheckChecked" name="loyltycheck" />
                    <br>
                    <br><span class="badge  bg-label-success mb-1 me-1 mt-1   ">On This Button To Save Loylty Points for This guest And<br><br> Send Speacial SMS.</span>
                 <br><br> <span class="mt-1 ">You Will Give {{i.loylty_rate_prsantage}}% Loylty Points On The Billing Amount. </span>
                </div>
                {%endfor%}
                {%endif%}
        </div>

        
        
        <div class="modal-footer">
            
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            Close
          </button>
          <button  class="btn btn-primary" id="submitButton">Checkout-Room</button>
        </div>
      </form>
    </div>
  </div>
</div>
</div>
</div>
</div>
</div>
<!--/ Bootstrap modals -->

<script>
    document.addEventListener('DOMContentLoaded', () => {
      // Check if element exists in the DOM
      const guestCheckinDateInput = document.getElementById('checkindate');
      if (!guestCheckinDateInput) {
          console.error("Element with ID 'guestcheckindate' not found in the DOM.");
          return;
      }
      
      // Get today's date
      const today = new Date();
      const year = today.getFullYear();
      const month = ('0' + (today.getMonth() + 1)).slice(-2); // Adding leading zero if needed
      const day = ('0' + today.getDate()).slice(-2); // Adding leading zero if needed
      const formattedDate = `${year}-${month}-${day}`;
      
      // Set the value of the date input to today's date
      guestCheckinDateInput.value = formattedDate;
      
      console.log(`Set guest check-in date to: ${formattedDate}`);
  });
</script>


<script>
    document.getElementById('myForm').addEventListener('submit', function(event) {
        var button = document.getElementById('submitButton');
        
        // Disable the button immediately when form is submitted
        button.disabled = true;
        
        // Re-enable the button after 4 seconds
        setTimeout(function() {
            button.disabled = false;
        }, 50000);
    });
</script>


<script>
  $(document).ready(function () {
    // Fetch company data on modal open
    $('#billToCompanyBtn').on('click', function () {
        $.ajax({
            url: '/get-companies/', // URL to fetch companies
            type: 'GET',
            success: function (data) {
                const companySelect = $('#companySelect');
                companySelect.empty();
                companySelect.append('<option value="">Select a company</option>');
                data.forEach(company => {
                    companySelect.append(`<option value="${company.id}">${company.companyname} - ${company.contact}</option>`);
                });
            },
            error: function () {
                alert('Error fetching companies. Please try again.');
            }
        });
    });

    // Submit the form
    $('#billToCompanyForm').on('submit', function (e) {
        e.preventDefault();  // Prevent default form submission

        const company_id = $('#companySelect').val();  // Get the selected company ID
        const invoice_id = $('input[name="invoice_id"]').val();  // Get the hidden invoice ID
        const value = $('input[name="value"]').val() || 'N/A';  // Get the value or default to 'N/A'

        // Check if company and invoice IDs are selected
        if (!company_id || !invoice_id) {
            alert('Please select a company and an invoice.');
            return;
        }

        const formData = {
            company_id: company_id,
            invoice_id: invoice_id,
            value: value,
            csrfmiddlewaretoken: $('input[name="csrfmiddlewaretoken"]').val()  // Include CSRF token
        };

        $.ajax({
            url: '/submit-form/',  // URL to submit the form
            type: 'POST',
            data: formData,
            success: function (response) {
                // Check if response contains success status
                if (response.status === 'success') {
                    alert(response.message);  // Show success message
                    $('#billToCompanyModal').modal('hide');  // Close the modal
                    $('#billToCompanyForm')[0].reset();  // Reset the form
                    location.reload();
                } else {
                    alert(response.message || 'An error occurred during form submission.');  // Show error message if any
                    location.reload();
                  }
            },
            error: function (xhr) {
                // Handle errors and display as alerts
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    alert(`Error: ${xhr.responseJSON.message}`);  // Display detailed error message
                } else {
                    alert('An unexpected error occurred. Please try again.');  // Fallback error message
                }
            }
        });
    });
});


</script>





 <!-- Bootstrap modals -->
             
                      <!-- Modal -->
                      <div class="modal fade" id="basicModal" tabindex="-1" aria-hidden="true">
                        <form action="{% url 'guestaddfromfolio' %}" method="post" >
                          {% csrf_token %}
                          
                        <div class="modal-dialog" role="document">
                          <div class="modal-content">
                            <input type="hidden" id="roombooknoidinput" name="roombookadvanceiddata" />
                            <input type="hidden" id="roomnoidinput" name="roomnodata" />
                            <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel1">Add More Guest Data</h5>
                              <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"
                              ></button>
                            </div>
                            {%for data in invoice_data%}
                
                            <input type="hidden" value="{{data.customer.id}}" name="guestid" />

                      {%endfor%}

                            <div class="modal-body">
                              <div class="row">
                                <div class="col mb-3">
                                  <label for="nameBasic" class="form-label">Name</label>
                                  <input type="text"  class="form-control" name="name" placeholder="Enter Name" />
                                </div>
                              </div>
                              <div class="row g-2">
                                <div class="col mb-0">
                                  <label for="number" class="form-label">Phone</label>
                                  <input type="text" id="emailBasic" class="form-control" name="phone" placeholder="xxxxxxxxx" />
                                </div>
                                <div class="col mb-0">
                                  <label for="dobBasic" class="form-label">Address</label>
                                  <input type="text" id="dobBasic" class="form-control" name="address" placeholder="Enter Full Address" />
                                </div>
                              </div>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                Close
                              </button>
                              <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>

               
                
            </div>


            
 <!-- Bootstrap modals -->
             
                      <!-- Modal -->
                      <div class="modal fade" id="basicModalextends" tabindex="-1" aria-hidden="true">
                        <form action="{% url 'extendscheck' %}" method="post" >
                          {% csrf_token %}
                          
                        <div class="modal-dialog" role="document">
                          <div class="modal-content">
                            <input type="hidden" id="roombooknoidinput" name="roombookadvanceiddata" />
                            <input type="hidden" id="roomnoidinput" name="roomnodata" />
                            <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel1">Extends Room </h5>
                              <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"
                              ></button>
                            </div>
                            {%for data in invoice_data%}
                
                            <input type="hidden" value="{{data.customer.id}}" name="guestid" />
                            <input type="hidden" value= "{{data.customer.created_checkoutdate|date:'Y-m-d'}}" id="lastcheckoutdate" />
                            <input type="hidden" value="{{ data.customer.checkoutdate|date:'Y-m-d' }}" id="checkoutdate" name="checkoutdate" />
                            <input type="hidden" value="{{data.id}}" name="invcid" />
                      {%endfor%}

                            <div class="modal-body">
                              <div class="row">
                                <div class="col mb-3">
                                  <label for="nameBasic" class="form-label">Check-Out Date</label>
                                  <input type="date" id="fromdate"  class="form-control" name="fromdate" placeholder="Enter Name" required/>
                                </div>
                              </div>
                              
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                Close
                              </button>
                              <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                          </div>
                        </div>

                        <script>
                          // Retrieve the value of checkoutdate from the hidden input
                          const checkoutdateInput = document.getElementById('checkoutdate');
                          if (checkoutdateInput) {
                            const checkoutdate = checkoutdateInput.value;
                        
                            // Function to add one day to the checkout date
                            function addOneDay(dateString) {
                              const date = new Date(dateString); // Parse the date
                              date.setDate(date.getDate() + 1); // Add 1 day
                              const year = date.getFullYear();
                              const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-based
                              const day = String(date.getDate()).padStart(2, '0');
                              return `${year}-${month}-${day}`; // Format: YYYY-MM-DD
                            }
                        
                            // Calculate the new minimum date (day after checkoutdate)
                            const minDate = addOneDay(checkoutdate);
                        
                            // Set the "min" attribute of the date input
                            const dateInput = document.getElementById('fromdate');
                            if (dateInput && minDate) {
                              dateInput.setAttribute('min', minDate);
                              console.log("Min date set to:", minDate); // Debugging line to verify
                            }
                          }
                        </script>
                        
                        


                      </div>
                    </div>
                  </div>
                </form>

               
                
            </div>



            

 <!-- Bootstrap modals -->
             
                      <!-- Modal -->
                      <div class="modal fade" id="basicModalecheckout" tabindex="-1" aria-hidden="true">
                        <form action="{% url 'checkoutroombyone' %}" method="post" >
                          {% csrf_token %}
                          
                        <div class="modal-dialog" role="document">
                          <div class="modal-content">
                            <input type="hidden" id="roombooknoidinput" name="roombookadvanceiddata" />
                            <input type="hidden" id="roomnoidinput" name="roomnodata" />
                            <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel1">Check-Out Room One By One</h5>
                              <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"
                              ></button>
                            </div>
                            {%for data in invoice_data%}
                
                            <input type="hidden" value="{{data.customer.id}}" name="guestid" />
                            


                      {%endfor%}

                            <div class="modal-body">
                              <div class="row">
                                <div class="col-12 ">
                                  <span class="text text-warning">Only one room can be selected at a time. If only one room exists, please fully check out that room; otherwise, checkout will not be possible.</span>
                                  <h6 class="text p-2">Current Rooms</h6>
                                  
                                  <select class="form-control" name="invoiceitemid"  required >
                                    <option  value="">Select a Room</option>
                                    {%for iteams in invoiceitemdata%}
                                  {%if iteams.is_room %}
                                    {%if iteams.is_checkout == False and iteams.is_extend == False %}
                                    <option  value="{{iteams.id}}">Room No: {{iteams.description}}</option>
                                    {%endif%}
                                    {%endif%}
                                    {%endfor%}
                                  </select>
                                 
                                  
                              </div>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                Close
                              </button>
                              <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>

               
                
            </div>




              <!-- Modal -->
              <div class="modal fade" id="basicModalextendsitem" tabindex="-1" aria-hidden="true">
                <form action="{% url 'extendscheckonebyone' %}"  method="post" >
                  {% csrf_token %}
                  
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <input type="hidden" id="roombooknoidinput" name="roombookadvanceiddata" />
                    <input type="hidden" id="roomnoidinput" name="roomnodata" />
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel1">Extends Room </h5>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      ></button>
                    </div>
                    {%for data in invoice_data%}
        
                    <input type="hidden" value="{{data.customer.id}}" name="guestid" />
                    
                    <input type="hidden" value="{{data.id}}" name="invcid" />
              {%endfor%}

              <input type="hidden" name="itemid" id="itemid" />

                    <div class="modal-body">
                      <div class="row">
                        <div class="col mb-3">
                          <label for="nameBasic" class="form-label">Check-Out Date</label>
                          <input type="date" id="itemcheckoutdate" name="checkoutdate"  class="form-control" readonly  required/>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col mb-3">
                          <label for="nameBasic" class="form-label">Extend Check-Out Date</label>
                          <input type="date" id="fromdateitem"  class="form-control" name="fromdate" placeholder="Enter Name" required/>
                        </div>
                      </div>
                      
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        Close
                      </button>
                      <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                  </div>
                </div>
                
                
                <script>
                  {% comment %} function setidanddate(id, date) {
                    console.log("Function Called! ID:", id, "Date:", date); // Debugging ke liye
                
                    document.getElementById('itemid').value = id;

                
                    let formattedDate = new Date(date);
                    
                    if (!isNaN(formattedDate.getTime())) { 
                        let isoDate = formattedDate.toISOString().split('T')[0];
                        document.getElementById('itemcheckoutdate').value = isoDate;
                      
                        // 🔴 **Manually trigger change event** taaki `min` update ho
                        document.getElementById('itemcheckoutdate').dispatchEvent(new Event("change"));
                    } else {
                        console.error("Invalid Date Format:", date);
                    }
                  } {% endcomment %}

                  function setidanddate(id, date) {
                    console.log("Function Called! ID:", id, "Date:", date); // Debugging ke liye
                
                    document.getElementById('itemid').value = id;
                
                    // 🔹 Direct date string ko new Date() me pass karna
                    let formattedDate = new Date(date);
                
                    if (!isNaN(formattedDate.getTime())) { 
                        // 🔹 YYYY-MM-DD format manually generate karna (without toISOString)
                        let year = formattedDate.getFullYear();
                        let month = String(formattedDate.getMonth() + 1).padStart(2, '0');
                        let day = String(formattedDate.getDate()).padStart(2, '0');
                        let isoDate = `${year}-${month}-${day}`; // ✅ India ke format me
                        
                        // 🔹 Date input me set karna
                        document.getElementById('itemcheckoutdate').value = isoDate;
                
                        // 🔴 Ensure min date updates
                        document.getElementById('itemcheckoutdate').dispatchEvent(new Event("change"));
                
                        console.log("Date set in input:", isoDate);
                    } else {
                        console.error("Invalid Date Format:", date);
                    }
                }
                
                
                 
                
                document.addEventListener("DOMContentLoaded", function () {
                  const checkoutdateInput = document.getElementById('itemcheckoutdate');
                  const dateInput = document.getElementById('fromdateitem');
              
                  if (checkoutdateInput) {
                      checkoutdateInput.addEventListener("change", function () {
                          const checkoutdate = checkoutdateInput.value;
              
                          if (!checkoutdate) {
                              console.error("Checkout date is empty!");
                              return;
                          }
              
                          // 🔹 Function to add 1 day (correcting midnight shift issue)
                          function addOneDay(dateString) {
                              let date = new Date(dateString + "T00:00:00"); // ✅ Midnight shift avoid
                              if (isNaN(date.getTime())) {
                                  console.error("Invalid Date Format:", dateString);
                                  return null;
                              }
              
                              date.setDate(date.getDate() + 1); // ✅ Corrected (no extra days)
                              const year = date.getFullYear();
                              const month = String(date.getMonth() + 1).padStart(2, '0');
                              const day = String(date.getDate()).padStart(2, '0');
              
                              return `${year}-${month}-${day}`;
                          }
              
                          const minDate = addOneDay(checkoutdate); // ✅ Fixed to only +1 day
              
                          if (dateInput && minDate) {
                              dateInput.setAttribute('min', minDate);
                              console.log("Min date set to:", minDate);
                          }
                      });
                  }
              });
              

                </script>
                


              </div>
            </div>
          </div>
        </form>

       
        
    </div>




<!-- Modal aedit payment -->
<div class="modal fade" id="editpaymnent" data-bs-backdrop="static" tabindex="-1">
  <div class="modal-dialog">
      <form action="{% url 'invoicepaymentedit'  %}" method="POST" class="modal-content">
          {% csrf_token %}

        
          <input type="hidden" name="invcids" value="" id="editinvcid">
          
      
      <div class="modal-header">
        <h5 class="modal-title" id="backDropModalTitle">Edit Payments</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <h6>This will always work with the lesser amount.!</h6>
        <div class="row">
          <div class="col mb-3">
            <label for="nameBackdrop" class="form-label">Amount</label>
            <input
              type="text"
              name="amount"
              id="editamount"
              class="form-control"
              placeholder="Enter Amount"
              value="{{i.Due_amount}}"
              required
            />
          </div>

          

          <div class="col mb-3">
              <label for="nameBackdrop" class="form-label">Payment Mode</label>
              <select class="form-control" name="paymentmode" id="editpaymode" required placeholder="Select Category" required>
                  
                  <option  value="cash">Cash</option>
                  <option  value="UPI">UPI</option>
                  <option  value="Cheque">Cheque</option>
                  <option  value="Card">Card</option>
                  <option  value="BankTransfer">BankTransfer</option>
                </select>
            </div>
            
        </div>
        <div class="row">
          

          
          <div class="col mb-3">
              <label for="nameBackdrop" class="form-label">Payment Details</label>
              <input
                type="text"
                name="paymntdetails"
                id="paymentdetails"
                class="form-control"
                placeholder="utr,check no"
                
              />
            </div>

            <div class="col mb-3">
              <label for="nameBackdrop" class="form-label">Comments</label>
              <input
                type="text"
                name="comment"
                id="Comments"
                class="form-control"
                placeholder=""
                
              />
            </div>
        </div>
      </div>

      
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
          Close
        </button>
        <button  class="btn btn-primary">Save</button>
      </div>
    </form>
  </div>
</div>
</div>
</div>
</div>
</div>
</div>
<!--/ Bootstrap modals -->
<script>
  function setpaymentedit(id,amount,mode,transection,description) {
    document.getElementById('editinvcid').value=id;
    document.getElementById('editamount').value=amount;
    document.querySelector("select[id='editpaymode']").value = mode;
    document.getElementById('paymentdetails').value=transection;
    document.getElementById('Comments').value=description;
  }
</script>
    

{%endblock%}