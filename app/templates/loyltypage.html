{% extends "base.html" %}
{% block content %}



<!--loylty data here-->
<div class="row    mt-4" style="height:450px">
  <div class="col-4 ms-4 card">
    
    <label for="nameBackdrop" class="form-label ms-5 mt-5 ">Guest Phone Number To Check Loyalty Data</label>
    <div class="input-group input-group-merge w-75 mt-2 ms-5">
      <span id="basic-icon-default-company2" class="input-group-text"
        ><i class="bx bx-phone"></i
            ></span>
      <input
        type="number"
        name = "guestphone"
        id="phoneguest"
        class="form-control "
        placeholder="Phone"
        aria-label="ACME Inc."
        aria-describedby="basic-icon-default-company2"
      />
    </div>
    
    <button id="btnsavedate" class="btn btn-primary w-75 mt-4 ms-5">Check Loyalty Data</button>
    <p class="text m-2 mt-5">
      Please wait while it displays the loyalty data. If the information is incorrect, refresh the page and try again.</p>
  </div>
  <div class="col-7 ms-3 card">
    
     <!-- List group Icons -->
     <div class="col-lg-12">
      <div class="demo-inline-spacing mt-3">
        <ul class="list-group">
          <li class="list-group-item d-flex align-items-center">
            <i class='bx bx-street-view me-2'></i>
             Guest Name  <span class="badge ms-5 w-25 bg-label-primary me-1" id="name"></span>
          </li>
          <li class="list-group-item d-flex align-items-center">
            <i class="bx bx-phone me-2"></i
              >
            Guest Contact  <span class="badge ms-4 me-1 w-25 bg-label-primary me-1" id="contact"></span>
          </li>
          
          <li class="list-group-item d-flex align-items-center">
            <i class="bx bx-purchase-tag-alt me-2"></i>
            Loyalty Points In â‚¹ 
            <span class="badge w-25 ms-2 bg-label-primary me-1" id="lyltyamount"></span>
            <span class="badge w-25 ms-2 bg-label-danger me-1" id="lyltyamountdelete"></span>
          </li>
          
          <!-- Error Display -->
          <div class="text-danger" id="errorshowajax"></div>
          
        </ul>
      </div>
    </div>
    <!--/ List group Icons -->


  </div>
  <!--end here-->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script>
    $("#btnsavedate").click(function(){
        let phoneno = $("#phoneguest").val();
        console.log(phoneno);
  
        // Clear previous data and error messages
        $("#name").empty();
        $("#contact").empty();
        $("#loyltypoint").empty();
        $("#lyltyamount").empty();
        $("#loyltyid").val('');
        $('#errorshowajax').empty();
        $('#lyltyamountdelete').empty();
        $.ajax ({
          type: "POST",
          url: "/getloyltydataajax",
          data: {
              Mobile: phoneno,
          },
          success: function (data) {
            if (data.error) {
                $('#errorshowajax').html('<p>Error: ' + data.error + '</p>');
            } else {
                var name, id, contact, loyltypoints;
                // Assuming data is an array of objects
                data.forEach(function(item) {
                  name = item.guest_name; // Assign guest_name to name variable
                  id = item.id; // Assign id to id variable
                  contact = item.guest_contact; // Assign guest_contact to contact variable
                  loyltypoints = item.loylty_point; // Assign loylty_point to loyltypoints variable
                });
                
                console.log(name);
                $("#name").html(name);
                $("#contact").html(contact);
                $("#loyltypoint").html(loyltypoints);
                $("#lyltyamount").html(loyltypoints);
                $("#loyltyid").val(id);
                $("#discountamount").val(loyltypoints);
            }
          },
          error: function(xhr, status, error) {
            $('#errorshowajax').html('<p>Error: ' + xhr.statusText + '</p>');
          }
        });
    });



    //delete loylty data 
    $("#Deleteloyltydata").click(function(){
      let phoneno = $("#phoneguest").val();
      console.log(phoneno);

      // Clear previous data and error messages
      $("#name").empty();
      $("#contact").empty();
      $("#loyltypoint").empty();
      $("#lyltyamount").empty();
      $("#loyltyid").val('');
      $('#errorshowajax').empty();
      console.log("worked")
      $.ajax ({
        type: "POST",
        url: "/deleteloyltyajaxdata",
        data: {
            Mobile: phoneno,
        },
        success: function (data) {
          if (data.error) {
              $('#errorshowajax').html('<p>Error: ' + data.error + '</p>');
          } else {
              var name, id, contact, loyltypoints;
              // Assuming data is an array of objects
              data.forEach(function(item) {
                name = item.guest_name; // Assign guest_name to name variable
                id = item.id; // Assign id to id variable
                contact = item.guest_contact; // Assign guest_contact to contact variable
                loyltypoints = item.loylty_point; // Assign loylty_point to loyltypoints variable
              });
              
              console.log(name);
              $("#name").html(name);
              $("#contact").html(contact);
              $("#loyltypoint").html(loyltypoints);
              $("#lyltyamountdelete").html(loyltypoints);
              $("#discountamount").val(loyltypoints);
          }
        },
        error: function(xhr, status, error) {
          $('#errorshowajax').html('<p>Error: ' + xhr.statusText + '</p>');
        }
      });
  });
  </script>






</div>
</div>
</div>


{% endblock %}